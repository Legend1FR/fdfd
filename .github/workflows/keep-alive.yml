name: Keep Server Alive

on:
  schedule:
    # ØªØ´ØºÙŠÙ„ ÙƒÙ„ 8 Ø¯Ù‚Ø§Ø¦Ù‚
    - cron: '*/8 * * * *'
  workflow_dispatch: # Ù„Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  ping:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping Server
      run: |
        echo "ğŸ”„ Pinging server at $(date)"
        
        # ping Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        response=$(curl -s -o /dev/null -w "%{http_code}" "https://cdcdcd.onrender.com/health" || echo "000")
        
        if [ "$response" = "200" ]; then
          echo "âœ… Server is alive - Status: $response"
          
          # Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
          health_data=$(curl -s "https://cdcdcd.onrender.com/health" || echo "{}")
          echo "ğŸ“Š Health check response:"
          echo "$health_data" | jq '.' 2>/dev/null || echo "$health_data"
          
        else
          echo "âŒ Server might be sleeping - Status: $response"
          
          # Ù…Ø­Ø§ÙˆÙ„Ø© ping Ø§Ù„Ù€ ping endpoint Ø£ÙŠØ¶Ø§Ù‹
          ping_response=$(curl -s -o /dev/null -w "%{http_code}" "https://cdcdcd.onrender.com/ping" || echo "000")
          echo "ğŸ“¡ Ping endpoint status: $ping_response"
          
          # Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ù€ health check Ù„ÙƒÙ† Ù†Ø¬Ø­ Ø§Ù„Ù€ pingØŒ ÙØ§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„
          if [ "$ping_response" = "200" ]; then
            echo "âœ… Server is actually alive (ping successful)"
          else
            echo "ğŸš¨ Server appears to be down"
            exit 1
          fi
        fi
        
        echo "ğŸ•’ Ping completed at $(date)"

    - name: Alternative Ping
      if: failure()
      run: |
        echo "ğŸ”„ Trying alternative ping methods..."
        
        # Ù…Ø­Ø§ÙˆÙ„Ø© ping Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        curl -f "https://cdcdcd.onrender.com/" || echo "Main page failed"
        
        # Ù…Ø­Ø§ÙˆÙ„Ø© ping endpoint Ø¨Ø³ÙŠØ·
        curl -f "https://cdcdcd.onrender.com/ping" || echo "Ping endpoint failed"
        
        # Ù…Ø­Ø§ÙˆÙ„Ø© ping status page
        curl -f "https://cdcdcd.onrender.com/status" || echo "Status page failed"
