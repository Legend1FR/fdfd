# ููุฎุต ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ - Token Tracking System

## ุชุงุฑูุฎ ุงูุชุญุฏูุซ: 16 ุฃุบุณุทุณ 2025

### ุงููุดุงูู ุงูุชู ุชู ุญููุง:

#### 1. โ ุฎุทุฃ Cloudflare 1015 (Rate Limiting)
**ุงููุดููุฉ ุงูุฃุตููุฉ:**
```
ุฎุทุฃ ูู ุชุญููู JSON: Unexpected token 'e', "error code: 1015" is not valid JSON
```

**ุงูุญููู ุงููุทุจูุฉ:**
- ๐ง ุฅุถุงูุฉ ูุธุงู ุฅุฏุงุฑุฉ ุงูุทูุจุงุช (RequestManager) ูุน ุชุฃุฎูุฑ 3 ุซูุงูู ุจูู ุงูุทูุจุงุช
- ๐ง ุชุญุณูู User-Agent ูุฅุถุงูุฉ headers ุฅุถุงููุฉ
- ๐ง ุฒูุงุฏุฉ ูุชุฑุฉ ูุฑุงูุจุฉ ุงูุฃุณุนุงุฑ ูู 10 ุซูุงูู ุฅูู 20 ุซุงููุฉ
- ๐ง ุฒูุงุฏุฉ timeout ูู 8 ุซูุงูู ุฅูู 15 ุซุงููุฉ

#### 2. โ ูุดููุฉ ูู ุงูุถุบุท (Compression)
**ุงููุดููุฉ ุงูุฃุตููุฉ:**
```
ุฎุทุฃ ูู ุชุญููู JSON: Unexpected token 'โผ', "โผโฅ"... is not valid JSON
```

**ุงูุญู ุงููุทุจู:**
- ๐ง ุฅุฒุงูุฉ header `Accept-Encoding: gzip, deflate, br` ูุชุฌูุจ ุงูุงุณุชุฌุงุจุงุช ุงููุถุบูุทุฉ

#### 3. โ ูุนุงูุฌุฉ ุฃูุถู ููุงุณุชุฌุงุจุงุช ุบูุฑ JSON
**ุงูุชุญุณููุงุช ุงููุทุจูุฉ:**
- ๐ง ุงูุชุญูู ูู HTTP Status Code ูุจู ูุนุงูุฌุฉ ุงูุจูุงูุงุช
- ๐ง ุงูุชุญูู ูู Content-Type ููุชุฃูุฏ ุฃู ุงูุงุณุชุฌุงุจุฉ JSON
- ๐ง ุงูุชุดุงู ุฃุฎุทุงุก Cloudflare ูุจู ูุญุงููุฉ JSON parsing
- ๐ง ุทุจุงุนุฉ ูุนุงููุฉ ููุงุณุชุฌุงุจุงุช ุงูุฎุทุฃ ูููุณุงุนุฏุฉ ูู ุงูุชุดุฎูุต

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:

#### ๐ ูุธุงู ุฅุฏุงุฑุฉ ุงูุทูุจุงุช ุงูุฐูู
```javascript
class RequestManager {
  constructor() {
    this.lastRequestTime = 0;
    this.minDelay = 3000; // 3 ุซูุงูู ูุญุฏ ุฃุฏูู ุจูู ุงูุทูุจุงุช
    this.requestQueue = [];
    this.processing = false;
  }
  
  async makeRequest(requestFn) {
    // ูุนุงูุฌุฉ ุงูุทูุจุงุช ูู queue ูุน ุชุฃุฎูุฑ ููุงุณุจ
  }
}
```

#### ๐ ูุนุงูุฌุฉ ูุญุณูุฉ ููุฃุฎุทุงุก
```javascript
// ุงูุชุญูู ูู Status Code
if (res.statusCode !== 200) {
  console.log(`โ HTTP Error: ${res.statusCode}`);
  return null;
}

// ุงูุชุญูู ูู Content-Type
const contentType = res.headers['content-type'] || '';
if (!contentType.includes('application/json')) {
  console.log(`โ ุฎุทุฃ: ุงูุงุณุชุฌุงุจุฉ ููุณุช JSON (${contentType})`);
  return null;
}

// ุงูุชุญูู ูู ุฃุฎุทุงุก Cloudflare
if (data.includes('error code: 1015') || data.includes('Cloudflare')) {
  console.log(`โ ุฎุทุฃ Cloudflare: Rate limiting detected`);
  return null;
}
```

#### โก ุชุญุณูู Headers
```javascript
headers: {
  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
  'Accept': 'application/json',
  'Accept-Language': 'en-US,en;q=0.9',
  'Connection': 'keep-alive',
  'Upgrade-Insecure-Requests': '1',
}
```

### ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ:

```
๐ ุจุฏุก ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุญุณู...

--- ุงูุงุฎุชุจุงุฑ 1/3 ---
โ ูุฌุญ ุงูุญุตูู ุนูู ุงูุณุนุฑ: $0.00006532
โฑ๏ธ ูุฏุฉ ุงูุทูุจ: 1393ms
โ ุงูุงุฎุชุจุงุฑ 1: ูุฌุญ

--- ุงูุงุฎุชุจุงุฑ 2/3 ---
โณ ุงูุชุธุงุฑ 2998ms ูุชุฌูุจ Rate Limiting...
โ ูุฌุญ ุงูุญุตูู ุนูู ุงูุณุนุฑ: $0.00006532
โฑ๏ธ ูุฏุฉ ุงูุทูุจ: 3043ms
โ ุงูุงุฎุชุจุงุฑ 2: ูุฌุญ

--- ุงูุงุฎุชุจุงุฑ 3/3 ---
โณ ุงูุชุธุงุฑ 2998ms ูุชุฌูุจ Rate Limiting...
โ ูุฌุญ ุงูุญุตูู ุนูู ุงูุณุนุฑ: $0.00006532
โฑ๏ธ ูุฏุฉ ุงูุทูุจ: 3080ms
โ ุงูุงุฎุชุจุงุฑ 3: ูุฌุญ
```

### ุงููููุงุช ุงูููุญุฏุซุฉ:

1. **server.js** - ุงูููุฏ ุงูุฃุณุงุณู ูุน ุฌููุน ุงูุฅุตูุงุญุงุช
2. **test_api_fixes.js** - ุณูุฑูุจุช ุงุฎุชุจุงุฑ ููุชุญูู ูู ุงูุฅุตูุงุญุงุช
3. **TROUBLESHOOTING_GUIDE.md** - ุฏููู ุดุงูู ูุงุณุชูุดุงู ุงูุฃุฎุทุงุก ูุฅุตูุงุญูุง

### ุงูุชููุนุงุช ุจุนุฏ ุงูุชุญุฏูุซ:

#### โ ูุง ูุฌุจ ุฃู ูุนูู ุงูุขู:
- ุฌูุจ ุงูุฃุณุนุงุฑ ุจุดูู ูุณุชูุฑ ุฏูู ุฃุฎุทุงุก Cloudflare
- ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ูุน ุฑุณุงุฆู ูุงุถุญุฉ
- ุชุฃุฎูุฑ ููุงุณุจ ุจูู ุงูุทูุจุงุช ูุชุฌูุจ Rate Limiting
- ุงุณุชุฌุงุจุฉ ุฃุณุฑุน ูุฃูุซุฑ ููุซูููุฉ

#### โ๏ธ ูุง ูุฌุจ ูุฑุงูุจุชู:
- ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ (ูุฌุจ ุฃู ุชููู ุฃูู ูู 5 ุซูุงูู)
- ุนุฏุฏ ุงูุฃุฎุทุงุก (ูุฌุจ ุฃู ููุฎูุถ ุจุดูู ูุจูุฑ)
- ุงุณุชูุฑุงุฑ ุงููุธุงู ุนูู ุงููุฏู ุงูุทููู

### ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุตู ุจูุง:

1. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**: ุฑุงูุจ ุงูุณุฌูุงุช ููุฏุฉ 24 ุณุงุนุฉ ููุชุฃูุฏ ูู ุงูุงุณุชูุฑุงุฑ
2. **ุถุจุท ุงููุนุงููุฑ**: ูุฏ ุชุญุชุงุฌ ูุชุนุฏูู ูุชุฑุฉ ุงูุชุฃุฎูุฑ ุญุณุจ ุงูุงุณุชุฎุฏุงู
3. **ุฅุถุงูุฉ ุงููุฒูุฏ ูู APIs**: ููุฑ ูู ุฅุถุงูุฉ APIs ุจุฏููุฉ ูููุฒูุฏ ูู ุงููุฑููุฉ
4. **ุชุทููุฑ Cache**: ุฅุถุงูุฉ ูุธุงู cache ููุชูููู ูู ุนุฏุฏ ุงูุทูุจุงุช

### ูุนูููุงุช ุงูุงุชุตุงู:
ูู ุญุงูุฉ ุงุณุชูุฑุงุฑ ุฃู ูุดุงููุ ุชุฃูุฏ ูู:
- ูุฑุงุฌุนุฉ ููู TROUBLESHOOTING_GUIDE.md
- ุชุดุบูู test_api_fixes.js ููุชุญูู ูู ุญุงูุฉ ุงููุธุงู
- ูุฑุงุฌุนุฉ ุงูุณุฌูุงุช ููุจุญุซ ุนู ุฃููุงุท ุฌุฏูุฏุฉ ูู ุงูุฃุฎุทุงุก
