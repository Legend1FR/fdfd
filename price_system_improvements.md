# تحسينات نظام جلب الأسعار 💰

## المزايا الجديدة:

### 1. 🚀 نظام جلب أسعار مبسط
- استخدام APIs متعددة بدلاً من puppeteer
- أسرع وأكثر استقراراً
- استهلاك أقل للذاكرة

### 2. 📊 تحسين عرض الأسعار
```
🪙 Token: ABC123...
💰 السعر الأول: $0.00008485
💰 السعر الحالي: $0.00008686
📈 التغيير: +2.37%
⏰ آخر تحديث: 2025-08-14 15:30:45
```

### 3. ⚡ مصادر متعددة للأسعار
- **DexScreener API** (المصدر الأساسي)
- **CoinGecko API** (احتياطي)
- يمكن إضافة مصادر أخرى بسهولة

### 4. 🎯 تنبيهات محسنة
- تنبيه عند الوصول لـ 50%
- تنبيه للارتفاع السريع
- رسائل منسقة وواضحة

## الدوال الجديدة المضافة:

### `getTokenPriceSimple(token)`
```javascript
// جلب السعر من APIs متعددة
const price = await getTokenPriceSimple("TOKEN_ADDRESS");
console.log(`السعر: $${price}`);
```

### `formatPrice(price)`
```javascript
// تنسيق السعر حسب القيمة
const formatted = formatPrice(0.00008485);
// Output: "0.00008485"
```

### `startSimplePriceTracking(token, startTime)`
```javascript
// بدء مراقبة مبسطة للتوكن
await startSimplePriceTracking("TOKEN_ADDRESS", Date.now());
```

## كيفية الاستخدام:

### 1. تفعيل النظام المبسط
النظام الجديد يعمل تلقائياً كأولوية أولى، وفي حالة الفشل يتحول لـ puppeteer

### 2. تخصيص المجموعات المستهدفة
```javascript
// في دالة sendToGroups، أضف معرفات المجموعات
const targetGroups = [
  -1001234567890,  // مجموعة 1
  -1001234567891,  // مجموعة 2
];
```

### 3. تعديل فترات المراقبة
```javascript
// تغيير فترة فحص السعر (افتراضي: 10 ثوان)
}, 10000); // 10 seconds

// تغيير مدة المراقبة الإجمالية (افتراضي: ساعة)
}, 60 * 60 * 1000); // 1 hour
```

## مثال على الاستخدام العملي:

```javascript
// بدء مراقبة توكن جديد
const token = "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM";
await startTrackingToken(token);

// النظام سيقوم بـ:
// 1. جلب السعر الأول من DexScreener
// 2. بدء مراقبة كل 10 ثوان
// 3. إرسال تنبيهات عند الارتفاع
// 4. عرض تحديثات منسقة في الكونسول
```

## مقارنة النظام القديم vs الجديد:

| الميزة | النظام القديم | النظام الجديد |
|--------|--------------|---------------|
| السرعة | بطيء (puppeteer) | سريع (API calls) |
| الذاكرة | عالية | منخفضة |
| الاستقرار | متوسط | عالي |
| سهولة الصيانة | معقد | بسيط |
| دقة الأسعار | جيدة | ممتازة (مصادر متعددة) |

## ملاحظات مهمة:

1. **النظام التلقائي**: يحاول النظام المبسط أولاً، ثم puppeteer كاحتياط
2. **مرونة الإعداد**: يمكن تعديل المصادر والفترات بسهولة
3. **معالجة الأخطاء**: النظام يتعامل مع فشل المصادر تلقائياً
4. **التوافق**: النظام الجديد متوافق مع الكود الموجود

## للتطوير المستقبلي:

### إضافة مصادر جديدة:
```javascript
{
  name: 'Jupiter',
  hostname: 'price.jup.ag',
  path: `/v4/price?ids=${token}`,
  parser: (data) => {
    return data.data?.[token]?.price || null;
  }
}
```

### تخصيص التنبيهات:
```javascript
// تنبيه مخصص للارتفاع
if (priceChangeFromFirst >= 100) { // 100%
  const message = `🚀🚀 ارتفاع مضاعف! ${priceChangeFromFirst.toFixed(2)}%`;
  sendToGroups(message);
}
```
