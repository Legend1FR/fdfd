const { TelegramClient } = require("telegram");
const { StringSession } = require("telegram/sessions");
const fs = require("fs");
const input = require("input");
const http = require("http");
const https = require("https");

const { performance } = require('perf_hooks');

/*
 * ØªØ­Ø¯ÙŠØ«: Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù† Ù…Ø¹ Ù†Ø¸Ø§Ù… ÙØ­Øµ rugcheck Ù…ØªØ·ÙˆØ±
 * - ØªÙ… Ø­Ø°Ù Ø§Ø³ØªØ®Ø¯Ø§Ù… Puppeteer Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø³Ø±Ø¹Ø©
 * - Ø§Ø³ØªØ®Ø¯Ø§Ù… APIs Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (DexScreener + CoinGecko)
 * - Ù†Ø¸Ø§Ù… ÙØ­Øµ rugcheck Ù…ØªØ·ÙˆØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… rugcheck_content_extractor.js
 * - ØªØµÙ†ÙŠÙ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙ‚Ø· (Ù„Ø§ Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£Ø¨Ø¯Ø§Ù‹):
 *   
 *   Ø¬Ù…Ù„ DANGER (Ø®Ø·Ø±):
 *   â€¢ "Large Amount of LP\" Unlocked\""
 *   â€¢ "Mutable metadata"
 *   â€¢ "Low Liquidity"
 *   â€¢ "Top 10 holders high ownership"
 *   â€¢ "Single holder ownership"
 *   â€¢ "honeypot"
 *   
 *   Ø¬Ù…Ù„ WARNING (ØªØ­Ø°ÙŠØ±):
 *   â€¢ "Copycat token"
 *   â€¢ "High holder correlation"
 *   â€¢ "Low Amount of holders"
 *   â€¢ "Creator history of rugged tokens"
 *   
 *   GOOD (Ø¢Ù…Ù†): Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ø£Ø¹Ù„Ø§Ù‡
 *   
 * - Ø§Ù„Ø¬Ù…Ù„ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚Ø© ØªÙ…Ø§Ù…Ø§Ù‹ (Ù†ÙØ³ Ø§Ù„Ø­Ø±ÙˆÙ ÙˆØ§Ù„Ù…Ø³Ø§ÙØ§Øª)
 * - ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ¬ÙˆØ¯ Ø®Ù„ÙŠØ· Ù…Ù† DANGER Ùˆ WARNINGØŒ ÙŠÙØµÙ†Ù ÙƒÙ€ DANGER
 * - Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©
 * - ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„ØªÙŠ ØªØ­Ù…Ù„ Ø­Ø§Ù„Ø© DANGER Ø£Ùˆ WARNING ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§ÙÙ‡Ø§
 * - ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø°Ø§Øª Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© ÙÙˆØ±Ø§Ù‹ 
 * - Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØ¹Ù…Ù„ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙˆÙƒÙ†Ø§Øª Ø®Ø·ÙŠØ±Ø©
 * - Ù†Ø¸Ø§Ù… Ø£Ø³Ø±Ø¹ ÙˆØ£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹ ÙˆØ¯Ù‚Ø©
 */

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
const trackedTokens = {};

// Ù…ØªØºÙŠØ± Ø¹Ø§Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
let globalClient = null;

// Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª
const MAX_TRACKED_TOKENS = 100;

// Ù…Ù„Ù Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªØªØ¨Ø¹Ø©
const trackedTokensFile = 'tracked_tokens.json';

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙƒØ±Ø±
const sentTokens = new Set();
const sentTokensFile = 'sent_tokens.txt';

// Ù…Ø®Ø²Ù† Ù…Ø¤Ù‚Øª Ù„Ø³Ø¬Ù„Ø§Øª ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°
const executionLogsBuffer = [];

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ù„Ù
function loadSentTokens() {
  try {
    if (fs.existsSync(sentTokensFile)) {
      const data = fs.readFileSync(sentTokensFile, 'utf8');
      const tokens = data.split('\n').filter(token => token.trim());
      tokens.forEach(token => sentTokens.add(token.trim()));
      console.log(`ğŸ“¨ Loaded ${tokens.length} sent tokens from file`);
    }
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', error.message);
  }
}

// Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„Ù
function saveSentTokens() {
  try {
    const tokensArray = Array.from(sentTokens);
    fs.writeFileSync(sentTokensFile, tokensArray.join('\n') + '\n', 'utf8');
    console.log(`ğŸ’¾ ØªÙ… Ø­ÙØ¸ ${tokensArray.length} ØªÙˆÙƒÙ† Ù…Ø±Ø³Ù„`);
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', error.message);
  }
}

// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† DexScreener API
async function fetchTokenInfo(token) {
  return new Promise((resolve) => {
    try {
      const apiOptions = {
        hostname: 'api.dexscreener.com',
        port: 443,
        path: `/latest/dex/tokens/${token}`,
        method: 'GET',
        headers: {
          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
          'Accept': 'application/json',
        }
      };
      
      const req = https.request(apiOptions, (res) => {
        let data = '';
        res.on('data', (chunk) => { data += chunk; });
        res.on('end', () => {
          try {
            const jsonData = JSON.parse(data);
            if (jsonData.pairs && jsonData.pairs.length > 0) {
              const pair = jsonData.pairs[0];
              const name = pair.baseToken?.name || null;
              const symbol = pair.baseToken?.symbol || null;
              
              if (name || symbol) {
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†
                if (trackedTokens[token]) {
                  trackedTokens[token].name = name;
                  trackedTokens[token].symbol = symbol;
                  saveTrackedTokens();
                  console.log(`[${token}] ØªÙ… Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†: ${name} (${symbol})`);
                }
                resolve({ name, symbol });
              } else {
                resolve(null);
              }
            } else {
              resolve(null);
            }
          } catch (parseError) {
            console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ JSON Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†: ${parseError.message}`);
            resolve(null);
          }
        });
      });
      
      req.on('error', (error) => {
        console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ API Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†: ${error.message}`);
        resolve(null);
      });
      
      req.setTimeout(10000, () => {
        console.log(`[${token}] Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ API Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†`);
        req.abort();
        resolve(null);
      });
      
      req.end();
    } catch (error) {
      console.log(`[${token}] ÙØ´Ù„ ÙÙŠ Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†: ${error.message}`);
      resolve(null);
    }
  });
}

// Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨Ø³Ø·Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… APIs Ù…ØªØ¹Ø¯Ø¯Ø©
async function getTokenPriceSimple(token) {
  console.log(`[${token}] ğŸ’° Fetching price...`);
  
  try {
    // Ù‚Ø§Ø¦Ù…Ø© APIs Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø±
    const priceAPIs = [
      {
        name: 'DexScreener',
        hostname: 'api.dexscreener.com',
        path: `/latest/dex/tokens/${token}`,
        parser: (data) => {
          if (data.pairs && data.pairs.length > 0) {
            return parseFloat(data.pairs[0].priceUsd);
          }
          return null;
        }
      },
      {
        name: 'CoinGecko',
        hostname: 'api.coingecko.com',
        path: `/api/v3/simple/token_price/solana?contract_addresses=${token}&vs_currencies=usd`,
        parser: (data) => {
          if (data[token] && data[token].usd) {
            return parseFloat(data[token].usd);
          }
          return null;
        }
      }
    ];

    for (const api of priceAPIs) {
      try {
        console.log(`[${token}] Ù…Ø­Ø§ÙˆÙ„Ø© ${api.name}...`);
        
        const options = {
          hostname: api.hostname,
          port: 443,
          path: api.path,
          method: 'GET',
          headers: {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Accept': 'application/json',
          }
        };

        const price = await new Promise((resolve) => {
          const req = https.request(options, (res) => {
            let data = '';
            res.on('data', (chunk) => { data += chunk; });
            res.on('end', () => {
              try {
                const jsonData = JSON.parse(data);
                const price = api.parser(jsonData);
                resolve(price);
              } catch (parseError) {
                console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ ${api.name}: ${parseError.message}`);
                resolve(null);
              }
            });
          });

          req.on('error', (error) => {
            console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ${api.name}: ${error.message}`);
            resolve(null);
          });

          req.setTimeout(8000, () => {
            console.log(`[${token}] Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© ${api.name}`);
            req.abort();
            resolve(null);
          });

          req.end();
        });

        if (price && price > 0) {
          console.log(`[${token}] âœ… ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† ${api.name}: $${price}`);
          return price;
        }

      } catch (apiError) {
        console.log(`[${token}] ÙØ´Ù„ ${api.name}: ${apiError.message}`);
        continue;
      }
    }

    console.log(`[${token}] âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±`);
    return null;

  } catch (error) {
    console.error(`[${token}] âŒ Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±: ${error.message}`);
    return null;
  }
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
function formatPrice(price) {
  if (!price || price === 0) return 'ØºÙŠØ± Ù…ØªØ§Ø­';
  
  if (price < 0.0001) {
    return price.toExponential(2);
  } else if (price < 0.01) {
    return price.toFixed(8);
  } else if (price < 1) {
    return price.toFixed(6);
  } else {
    return price.toFixed(4);
  }
}

// Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªØªØ¨Ø¹Ø© Ø¥Ù„Ù‰ Ù…Ù„Ù
function saveTrackedTokens() {
  try {
    const tokensToSave = {};
    Object.keys(trackedTokens).forEach(token => {
      const t = trackedTokens[token];
      tokensToSave[token] = {
        token: t.token,
        name: t.name,
        symbol: t.symbol,
        startTime: t.startTime,
        firstPrice: t.firstPrice,
        lastPrice: t.lastPrice,
        maxIncrease: t.maxIncrease,
        reached50: t.reached50,
        stopped: t.stopped,
        rugcheckStatus: t.rugcheckStatus, // Ø¥Ø¶Ø§ÙØ© Ø­ÙØ¸ Ø­Ø§Ù„Ø© rugcheck
        lowLiquidity: t.lowLiquidity, // Ø¥Ø¶Ø§ÙØ© Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠÙˆÙ„Ø©
        solValue: t.solValue, // Ø¥Ø¶Ø§ÙØ© Ø­ÙØ¸ Ù‚ÙŠÙ…Ø© SOL
        // Ø¥Ø¶Ø§ÙØ© Ø­ÙØ¸ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        previousHighPrice: t.previousHighPrice,
        currentHighPrice: t.currentHighPrice,
        lastRiseTime: t.lastRiseTime,
        rapidRiseAchieved: t.rapidRiseAchieved,
        priceRiseHistory: t.priceRiseHistory || [], // ØªØ£ÙƒØ¯ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ù…ØµÙÙˆÙØ©
        // Ø®ØµØ§Ø¦Øµ Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØªØ¨Ø¹ Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹
        highestPrice: t.highestPrice,
        maxRisePercentage: t.maxRisePercentage,
        priceHistoryEvery20s: t.priceHistoryEvery20s || [],
        lastPriceUpdate20s: t.lastPriceUpdate20s
        // Ù„Ø§ Ù†Ø­ÙØ¸ page Ù„Ø£Ù†Ù‡Ø§ ÙƒØ§Ø¦Ù†Ø§Øª ØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ³Ù„Ø³Ù„
      };
    });
    fs.writeFileSync(trackedTokensFile, JSON.stringify(tokensToSave, null, 2), 'utf8');
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªØªØ¨Ø¹Ø©:', error.message);
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªØªØ¨Ø¹Ø© Ù…Ù† Ù…Ù„Ù
function loadTrackedTokens() {
  try {
    if (fs.existsSync(trackedTokensFile)) {
      const savedTokens = JSON.parse(fs.readFileSync(trackedTokensFile, 'utf8'));
      Object.keys(savedTokens).forEach(token => {
        const savedToken = savedTokens[token];
        trackedTokens[token] = {
          ...savedToken,
          name: savedToken.name || null, // ØªØ­Ù…ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØªÙˆÙƒÙ†
          symbol: savedToken.symbol || null, // ØªØ­Ù…ÙŠÙ„ Ø±Ù…Ø² Ø§Ù„ØªÙˆÙƒÙ†
          startTime: new Date(savedToken.startTime), // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† string Ø¥Ù„Ù‰ Date
          rugcheckStatus: savedToken.rugcheckStatus || 'UNKNOWN', // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© rugcheck Ø£Ùˆ ØªØ¹ÙŠÙŠÙ† UNKNOWN Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
          lowLiquidity: savedToken.lowLiquidity !== undefined ? savedToken.lowLiquidity : null, // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŒ null = Ù„Ù… ÙŠØªÙ… ÙØ­ØµÙ‡Ø§
          solValue: savedToken.solValue || null, // ØªØ­Ù…ÙŠÙ„ Ù‚ÙŠÙ…Ø© SOL
          // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
          previousHighPrice: savedToken.previousHighPrice || null,
          currentHighPrice: savedToken.currentHighPrice || null,
          lastRiseTime: savedToken.lastRiseTime ? new Date(savedToken.lastRiseTime) : null,
          rapidRiseAchieved: savedToken.rapidRiseAchieved || false,
          priceRiseHistory: savedToken.priceRiseHistory || [], // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ØµÙÙˆÙØ©
          // Ø®ØµØ§Ø¦Øµ Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØªØ¨Ø¹ Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹
          highestPrice: savedToken.highestPrice || null,
          maxRisePercentage: savedToken.maxRisePercentage || 0,
          priceHistoryEvery20s: savedToken.priceHistoryEvery20s || [],
          lastPriceUpdate20s: savedToken.lastPriceUpdate20s ? new Date(savedToken.lastPriceUpdate20s) : null
        };
      });
      console.log(`ğŸ“Š Loaded ${Object.keys(savedTokens).length} tokens from saved file`);
      
      // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‚ÙŠÙ… Ø³ÙŠÙˆÙ„Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©
      let needsSave = false;
      Object.keys(trackedTokens).forEach(token => {
        if (trackedTokens[token].lowLiquidity === null) {
          trackedTokens[token].lowLiquidity = false; // Ø§ÙØªØ±Ø§Ø¶ Ø³ÙŠÙˆÙ„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          needsSave = true;
        }
      });
      
      // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¥Ø°Ø§ ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø£ÙŠ ØªÙˆÙƒÙ†Ø§Øª
      if (needsSave) {
        saveTrackedTokens();
        console.log(`ğŸ”§ Fixed liquidity values for old tokens`);
      }
      
      // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù… ØªØªÙˆÙ‚Ù
      Object.keys(trackedTokens).forEach(token => {
        const t = trackedTokens[token];
        
        // Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ØªÙˆÙØ±Ø©
        if (!t.name && !t.symbol) {
          fetchTokenInfo(token).catch(error => {
            console.error(`[${token}] ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†: ${error.message}`);
          });
        }
        
        if (!t.stopped) {
          console.log(`ğŸ”„ Restarting token monitoring: ${token}`);
          startAPITracking(token, t.startTime).catch(err => {
            console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: ${err.message}`);
          });
        }
      });
    }
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªØªØ¨Ø¹Ø©:', error.message);
  }
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… rugcheck_content_extractor.js
async function checkTokenSafety(token) {
  console.log(`[${token}] ğŸ” ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©...`);
  
  try {
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… rugcheck_content_extractor.js
    const RugcheckContentExtractor = require('./rugcheck_content_extractor');
    const extractor = new RugcheckContentExtractor();
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø³Ù‚
    const formattedContent = await extractor.extractFormattedContent(token);
    console.log(`[${token}] ğŸ“„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬: ${formattedContent.substring(0, 200)}...`);
    
    // Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ù…Ù„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¨Ø¯Ù‚Ø© (ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø·Ø§Ø¨Ù‚Ø© ØªÙ…Ø§Ù…Ø§Ù‹)
    const dangerSentences = [
      "Large Amount of LP\" Unlocked\"",
      "Mutable metadata",
      "Low Liquidity",
      "Top 10 holders high ownership",
      "Single holder ownership",
      "honeypot"
    ];
    
    const warningSentences = [
      "Copycat token",
      "High holder correlation",
      "Low Amount of holders",
      "Creator history of rugged tokens"
    ];
    
    let foundDanger = false;
    let foundWarning = false;
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…Ù„ Ø§Ù„Ø®Ø·Ø± (DANGER)
    for (const sentence of dangerSentences) {
      if (formattedContent.includes(sentence)) {
        console.log(`[${token}] ğŸ”´ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ù…Ù„Ø© Ø®Ø·Ø±: "${sentence}"`);
        foundDanger = true;
        break; // Ù†Ø®Ø±Ø¬ ÙÙˆØ± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø¬Ù…Ù„Ø© Ø®Ø·Ø±
      }
    }
    
    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø¬Ù…Ù„Ø© Ø®Ø·Ø±ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ± (WARNING)
    if (!foundDanger) {
      for (const sentence of warningSentences) {
        if (formattedContent.includes(sentence)) {
          console.log(`[${token}] âš ï¸ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ù…Ù„Ø© ØªØ­Ø°ÙŠØ±: "${sentence}"`);
          foundWarning = true;
          break; // Ù†Ø®Ø±Ø¬ ÙÙˆØ± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø¬Ù…Ù„Ø© ØªØ­Ø°ÙŠØ±
        }
      }
    }
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    if (foundDanger) {
      console.log(`[${token}] ğŸ”´ Ø§Ù„ØªÙˆÙƒÙ† Ø®Ø·Ø± - ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…Ù„Ø© Ø®Ø·Ø±`);
      return 'DANGER';
    } else if (foundWarning) {
      console.log(`[${token}] âš ï¸ Ø§Ù„ØªÙˆÙƒÙ† ØªØ­Ø°ÙŠØ±ÙŠ - ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…Ù„Ø© ØªØ­Ø°ÙŠØ±`);
      return 'WARNING';
    } else {
      console.log(`[${token}] âœ… Ø§Ù„ØªÙˆÙƒÙ† Ø¢Ù…Ù† - Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…Ù„ Ø®Ø·Ø± Ø£Ùˆ ØªØ­Ø°ÙŠØ±`);
      return 'GOOD';
    }
    
  } catch (error) {
    console.error(`[${token}] âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ†: ${error.message}`);
    
    // Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
    try {
      const apiResult = await checkTokenSafetyAPI(token);
      if (apiResult !== 'UNKNOWN') {
        console.log(`[${token}] âœ… Ù†ØªÙŠØ¬Ø© API Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø®Ø·Ø£: ${apiResult}`);
        return apiResult;
      }
    } catch (fallbackError) {
      console.error(`[${token}] âŒ Ø®Ø·Ø£ ÙÙŠ API Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø£ÙŠØ¶Ø§Ù‹: ${fallbackError.message}`);
    }
    
    return 'UNKNOWN';
  }
}

// Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù…Ø¨Ø§Ø´Ø± Ù„Ù€ rugcheck
async function checkTokenSafetyAPI(token) {
  try {
    const options = {
      hostname: 'api.rugcheck.xyz',
      port: 443,
      path: `/v1/tokens/${token}`,
      method: 'GET',
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        'Accept': 'application/json',
      }
    };

    return new Promise((resolve) => {
      const req = https.request(options, (res) => {
        let data = '';
        res.on('data', (chunk) => { data += chunk; });
        res.on('end', () => {
          try {
            const jsonData = JSON.parse(data);
            if (jsonData.risk_score !== undefined) {
              const riskScore = jsonData.risk_score;
              console.log(`[${token}] Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù…Ù† API: ${riskScore}`);
              if (riskScore <= 30) {
                resolve('GOOD');
              } else if (riskScore <= 69) {
                resolve('WARNING');
              } else {
                resolve('DANGER');
              }
            } else {
              resolve('UNKNOWN');
            }
          } catch (parseError) {
            console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ JSON Ù…Ù† API: ${parseError.message}`);
            resolve('UNKNOWN');
          }
        });
      });

      req.on('error', (error) => {
        console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ API: ${error.message}`);
        resolve('UNKNOWN');
      });

      req.setTimeout(10000, () => {
        console.log(`[${token}] Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ API`);
        req.abort();
        resolve('UNKNOWN');
      });

      req.end();
    });
  } catch (error) {
    console.error(`[${token}] Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ API: ${error.message}`);
    return 'UNKNOWN';
  }
}

// Ø¨Ø¯ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù„Ø¨ HTML Ø§Ù„Ø¨Ø³ÙŠØ·
async function checkTokenSafetySimple(token) {
  try {
    const options = {
      hostname: 'rugcheck.xyz',
      port: 443,
      path: `/tokens/${token}`,
      method: 'GET',
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
      }
    };

    return new Promise((resolve) => {
      const req = https.request(options, (res) => {
        let data = '';
        res.on('data', (chunk) => { data += chunk; });
        res.on('end', () => {
          try {
            const htmlContent = data.toLowerCase();
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙÙŠ HTML
            const riskScoreMatch = htmlContent.match(/(\d+)\s*\/\s*100/) || 
                                 htmlContent.match(/risk[:\s]*(\d+)/i);
            
            if (riskScoreMatch) {
              const riskScore = parseInt(riskScoreMatch[1]);
              console.log(`[${token}] ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${riskScore}`);
              
              if (riskScore <= 30) {
                resolve('GOOD');
              } else if (riskScore <= 69) {
                resolve('WARNING');
              } else {
                resolve('DANGER');
              }
            } else {
              // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
              if (htmlContent.includes('high risk') || htmlContent.includes('dangerous') || 
                  htmlContent.includes('scam') || htmlContent.includes('honeypot')) {
                resolve('DANGER');
              } else if (htmlContent.includes('medium risk') || htmlContent.includes('warning')) {
                resolve('WARNING');
              } else if (htmlContent.includes('low risk') || htmlContent.includes('safe')) {
                resolve('GOOD');
              } else {
                resolve('UNKNOWN');
              }
            }
          } catch (parseError) {
            console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ HTML: ${parseError.message}`);
            resolve('UNKNOWN');
          }
        });
      });

      req.on('error', (error) => {
        console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ HTML: ${error.message}`);
        resolve('UNKNOWN');
      });

      req.setTimeout(15000, () => {
        console.log(`[${token}] Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ HTML`);
        req.abort();
        resolve('UNKNOWN');
      });

      req.end();
    });
  } catch (error) {
    console.error(`[${token}] Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø¬Ù„Ø¨ HTML: ${error.message}`);
    return 'UNKNOWN';
  }
}

// Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù…Ø¨Ø§Ø´Ø± Ù„Ù€ rugcheck
async function checkTokenSafetyAPI(token) {
  try {
    const options = {
      hostname: 'api.rugcheck.xyz',
      port: 443,
      path: `/v1/tokens/${token}`,
      method: 'GET',
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        'Accept': 'application/json',
      }
    };

    return new Promise((resolve) => {
      const req = https.request(options, (res) => {
        let data = '';
        res.on('data', (chunk) => { data += chunk; });
        res.on('end', () => {
          try {
            const jsonData = JSON.parse(data);
            if (jsonData.risk_score !== undefined) {
              const riskScore = jsonData.risk_score;
              console.log(`[${token}] Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù…Ù† API: ${riskScore}`);
              if (riskScore <= 30) {
                resolve('GOOD');
              } else if (riskScore <= 69) {
                resolve('WARNING');
              } else {
                resolve('DANGER');
              }
            } else {
              resolve('UNKNOWN');
            }
          } catch (parseError) {
            console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ JSON Ù…Ù† API: ${parseError.message}`);
            resolve('UNKNOWN');
          }
        });
      });

      req.on('error', (error) => {
        console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ API: ${error.message}`);
        resolve('UNKNOWN');
      });

      req.setTimeout(10000, () => {
        console.log(`[${token}] Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ API`);
        req.abort();
        resolve('UNKNOWN');
      });

      req.end();
    });
  } catch (error) {
    console.error(`[${token}] Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ API: ${error.message}`);
    return 'UNKNOWN';
  }
}

// Ø¨Ø¯ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù„Ø¨ HTML Ø§Ù„Ø¨Ø³ÙŠØ·
async function checkTokenSafetySimple(token) {
  try {
    const options = {
      hostname: 'rugcheck.xyz',
      port: 443,
      path: `/tokens/${token}`,
      method: 'GET',
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
      }
    };

    return new Promise((resolve) => {
      const req = https.request(options, (res) => {
        let data = '';
        res.on('data', (chunk) => { data += chunk; });
        res.on('end', () => {
          try {
            const htmlContent = data.toLowerCase();
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙÙŠ HTML
            const riskScoreMatch = htmlContent.match(/(\d+)\s*\/\s*100/) || 
                                 htmlContent.match(/risk[:\s]*(\d+)/i);
            
            if (riskScoreMatch) {
              const riskScore = parseInt(riskScoreMatch[1]);
              console.log(`[${token}] ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${riskScore}`);
              
              if (riskScore <= 30) {
                resolve('GOOD');
              } else if (riskScore <= 69) {
                resolve('WARNING');
              } else {
                resolve('DANGER');
              }
            } else {
              // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
              if (htmlContent.includes('high risk') || htmlContent.includes('dangerous') || 
                  htmlContent.includes('scam') || htmlContent.includes('honeypot')) {
                resolve('DANGER');
              } else if (htmlContent.includes('medium risk') || htmlContent.includes('warning')) {
                resolve('WARNING');
              } else if (htmlContent.includes('low risk') || htmlContent.includes('safe')) {
                resolve('GOOD');
              } else {
                resolve('UNKNOWN');
              }
            }
          } catch (parseError) {
            console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ HTML: ${parseError.message}`);
            resolve('UNKNOWN');
          }
        });
      });

      req.on('error', (error) => {
        console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ HTML: ${error.message}`);
        resolve('UNKNOWN');
      });

      req.setTimeout(15000, () => {
        console.log(`[${token}] Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ HTML`);
        req.abort();
        resolve('UNKNOWN');
      });

      req.end();
    });
  } catch (error) {
    console.error(`[${token}] Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø¬Ù„Ø¨ HTML: ${error.message}`);
    return 'UNKNOWN';
  }
}

// Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… APIs (DexScreener + CoinGecko)
async function startAPITracking(token, startTime) {
  console.log(`[${token}] ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… API...`);
  
  // ÙØ­Øµ rugcheck Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ÙØ­ØµÙ‡ Ù…Ù† Ù‚Ø¨Ù„
  if (!trackedTokens[token].rugcheckStatus || trackedTokens[token].rugcheckStatus === 'UNKNOWN') {
    console.log(`[${token}] ğŸ” ÙØ­Øµ rugcheck Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...`);
    try {
      const rugcheckResult = await checkRugcheckSimple(token);
      if (trackedTokens[token]) {
        trackedTokens[token].rugcheckStatus = rugcheckResult;
        saveTrackedTokens();
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙˆÙƒÙ† Ø®Ø·ÙŠØ± Ø£Ùˆ ØªØ­Ø°ÙŠØ±ÙŠØŒ Ø£ÙˆÙ‚Ù Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙÙˆØ±Ø§Ù‹
        if (rugcheckResult === 'DANGER' || rugcheckResult === 'WARNING') {
          console.log(`[${token}] ğŸ—‘ï¸ Ø§Ù„ØªÙˆÙƒÙ† ${rugcheckResult === 'DANGER' ? 'Ø®Ø·ÙŠØ±' : 'ØªØ­Ø°ÙŠØ±ÙŠ'} - Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙÙˆØ±Ø§Ù‹`);
          stopTrackingToken(token);
          return;
        }
      }
    } catch (rugcheckError) {
      console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ rugcheck: ${rugcheckError.message}`);
      // Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ ÙØ­Øµ rugcheck
    }
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ÙˆÙ„ Ø³Ø¹Ø± Ù…Ø­ÙÙˆØ¸ Ù…Ø³Ø¨Ù‚Ø§Ù‹
  let firstPrice = (trackedTokens[token] && trackedTokens[token].firstPrice && typeof trackedTokens[token].firstPrice === 'number') 
                   ? trackedTokens[token].firstPrice 
                   : null;

  // Ø¬Ù„Ø¨ Ø£ÙˆÙ„ Ø³Ø¹Ø± Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­ÙÙˆØ¸Ø§Ù‹ Ù…Ø³Ø¨Ù‚Ø§Ù‹
  if (firstPrice === null) {
    console.log(`[${token}] Ø¬Ù„Ø¨ Ø£ÙˆÙ„ Ø³Ø¹Ø±...`);
    let attempts = 0;
    const maxAttempts = 3;
    
    while (firstPrice === null && attempts < maxAttempts) {
      attempts++;
      firstPrice = await getTokenPriceSimple(token);
      if (firstPrice === null && attempts < maxAttempts) {
        await new Promise(r => setTimeout(r, 5000));
      }
    }
    
    if (firstPrice === null) {
      console.error(`[${token}] ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ ${maxAttempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª. Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©.`);
      if (trackedTokens[token]) {
        trackedTokens[token].firstPrice = "ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±";
        trackedTokens[token].lastPrice = "ØºÙŠØ± Ù…ØªØ§Ø­";
        saveTrackedTokens();
      }
      return;
    }
  }

  // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø£Ø®ÙŠØ±
  if (trackedTokens[token]) {
    if (!trackedTokens[token].firstPrice || typeof trackedTokens[token].firstPrice !== 'number') {
      trackedTokens[token].firstPrice = firstPrice;
    }
    if (!trackedTokens[token].lastPrice || typeof trackedTokens[token].lastPrice !== 'number') {
      trackedTokens[token].lastPrice = firstPrice;
    }
    saveTrackedTokens();
  }

  console.log(`[${token}] âœ… Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© - ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„: $${formatPrice(firstPrice)}`);

  // Ø­Ù„Ù‚Ø© Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø¨Ø³Ø·Ø©
  (async function updateLoop() {
    while (trackedTokens[token] && !trackedTokens[token].stopped) {
      try {
        // ÙØ­Øµ Ø­Ø§Ù„Ø© rugcheck - Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© ÙÙˆØ±Ø§Ù‹
        if (trackedTokens[token].rugcheckStatus === 'DANGER' || trackedTokens[token].rugcheckStatus === 'WARNING') {
          console.log(`[${token}] ğŸ—‘ï¸ ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªÙˆÙƒÙ† ${trackedTokens[token].rugcheckStatus === 'DANGER' ? 'Ø®Ø·ÙŠØ±' : 'ØªØ­Ø°ÙŠØ±ÙŠ'} Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© - Ø¥ÙŠÙ‚Ø§Ù ÙÙˆØ±ÙŠ`);
          break;
        }

        // ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©
        if (trackedTokens[token].lowLiquidity === true) {
          console.log(`[${token}] ğŸ—‘ï¸ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© - Ø¥ÙŠÙ‚Ø§Ù ÙÙˆØ±ÙŠ`);
          break;
        }
        
        const currentPrice = await getTokenPriceSimple(token);
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø§ Ø²Ø§Ù„ Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙˆÙ„Ù… ÙŠÙØ­Ø°Ù Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        if (!trackedTokens[token]) break;
        
        if (currentPrice && currentPrice > 0) {
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
          trackedTokens[token].lastPrice = currentPrice;
          
          // ØªØ­Ø¯ÙŠØ« Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆØµÙ„ Ø¥Ù„ÙŠÙ‡ Ø§Ù„ØªÙˆÙƒÙ†
          if (!trackedTokens[token].highestPrice || currentPrice > trackedTokens[token].highestPrice) {
            trackedTokens[token].highestPrice = currentPrice;
            
            // Ø­Ø³Ø§Ø¨ Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ø±ØªÙØ§Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„ ÙˆØ£Ø¹Ù„Ù‰ Ø³Ø¹Ø±
            const maxRise = ((currentPrice - trackedTokens[token].firstPrice) / trackedTokens[token].firstPrice) * 100;
            if (maxRise > trackedTokens[token].maxRisePercentage) {
              trackedTokens[token].maxRisePercentage = maxRise;
            }
          }
          
          // ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ„ 20 Ø«Ø§Ù†ÙŠØ©
          const currentTime = new Date();
          if (!trackedTokens[token].lastPriceUpdate20s || 
              (currentTime - trackedTokens[token].lastPriceUpdate20s) >= 20000) {
            
            // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† Ø¢Ø®Ø± Ø³Ø¹Ø± Ù…Ø³Ø¬Ù„
            let changePercent = 0;
            if (trackedTokens[token].priceHistoryEvery20s.length > 0) {
              const lastRecord = trackedTokens[token].priceHistoryEvery20s[trackedTokens[token].priceHistoryEvery20s.length - 1];
              changePercent = ((currentPrice - lastRecord.price) / lastRecord.price) * 100;
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            trackedTokens[token].priceHistoryEvery20s.push({
              price: currentPrice,
              changePercent: changePercent,
              timestamp: currentTime
            });
            
            // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 50 Ø³Ø¬Ù„ ÙÙ‚Ø· (Ø­ÙˆØ§Ù„ÙŠ 16 Ø¯Ù‚ÙŠÙ‚Ø©)
            if (trackedTokens[token].priceHistoryEvery20s.length > 50) {
              trackedTokens[token].priceHistoryEvery20s = trackedTokens[token].priceHistoryEvery20s.slice(-50);
            }
            
            trackedTokens[token].lastPriceUpdate20s = currentTime;
          }
          
          // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø²ÙŠØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„
          const increase = ((currentPrice - trackedTokens[token].firstPrice) / trackedTokens[token].firstPrice) * 100;
          if (increase > trackedTokens[token].maxIncrease) trackedTokens[token].maxIncrease = increase;
          
          console.log(`[${token}] ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: $${formatPrice(currentPrice)} | Ø§Ø±ØªÙØ§Ø¹: ${increase.toFixed(2)}%`);
          
          // Ø±Ø³Ø§Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø­Ø§Ù„Ø©
          if (!trackedTokens[token].reached50) {
            if (increase < 10) {
              console.log(`[${token}] ğŸ“ˆ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø±ØªÙØ§Ø¹ Ø£ÙƒØ¨Ø± (Ø§Ù„Ù‡Ø¯Ù: 50%)...`);
            } else if (increase >= 10 && increase < 25) {
              console.log(`[${token}] ğŸ“Š Ø§Ø±ØªÙØ§Ø¹ Ø¬ÙŠØ¯! ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù€ 50%...`);
            } else if (increase >= 25 && increase < 50) {
              console.log(`[${token}] ğŸš€ Ø§Ø±ØªÙØ§Ø¹ Ù…Ù…ØªØ§Ø²! Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù€ 50%...`);
            }
          }
          
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠØµÙ„ Ø¨Ø¹Ø¯ Ø¥Ù„Ù‰ 50% ÙˆØ­Ù‚Ù‚Ù‡Ø§ Ø§Ù„Ø¢Ù†ØŒ Ø«Ø¨Ù‘Øª reached50 Ø¹Ù„Ù‰ true
          if (!trackedTokens[token].reached50 && increase >= 50) {
            trackedTokens[token].reached50 = true;
            console.log(`[${token}] ğŸš€ ÙˆØµÙ„ Ø¥Ù„Ù‰ 50%! Ø§Ù„Ø§Ø±ØªÙØ§Ø¹: ${increase.toFixed(2)}%`);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© rugcheck - Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙÙ‚Ø· Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø¢Ù…Ù†Ø©
            if (trackedTokens[token].rugcheckStatus === 'GOOD') {
              console.log(`[${token}] âœ… Ø´Ø±Ø· Ø§Ù„Ù€ 50% Ù…Ø­Ù‚Ù‚ + Ø§Ù„ØªÙˆÙƒÙ† Ø¢Ù…Ù† - Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡`);
              
              // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø³Ø¨Ù‚
              if (!sentTokens.has(token)) {
                // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙˆÙƒÙ†
                try {
                  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§ØªØµØ§Ù„ Telegram
                  if (!globalClient) {
                    console.warn(`[${token}] âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Telegram - ØªØ®Ø·ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡`);
                    return;
                  }
                  
                  const buyMsg = `/buy ${token} ${buyPrice}`;
                  await globalClient.sendMessage(botUsername, { message: buyMsg });
                  await globalClient.sendMessage(botUsername, { message: token });
                  console.log(`[${token}] âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:`, buyMsg);
                  console.log(`[${token}] ğŸ“© ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©.`);

                  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø©
                  sentTokens.add(token);
                  saveSentTokens();
                } catch (sendError) {
                  console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡: ${sendError.message}`);
                }
              } else {
                console.log(`[${token}] âš ï¸ Ø§Ù„ØªÙˆÙƒÙ† ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù…Ø³Ø¨Ù‚Ù‹Ø§ØŒ ØªØ®Ø·ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙƒØ±Ø±`);
              }
            } else {
              console.log(`[${token}] âš ï¸ ÙˆØµÙ„ Ø¥Ù„Ù‰ 50% Ù„ÙƒÙ† Ø§Ù„ØªÙˆÙƒÙ† Ù„ÙŠØ³ Ø¢Ù…Ù†Ù‹Ø§ (${trackedTokens[token].rugcheckStatus}) - Ù„Ù† ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡`);
            }
          }
          
          // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
          const now = Date.now();
          if (!trackedTokens[token].lastSave || now - trackedTokens[token].lastSave > 60000) {
            trackedTokens[token].lastSave = now;
            saveTrackedTokens();
          }
        } else {
          console.log(`[${token}] âš ï¸ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ`);
        }
      } catch (error) {
        console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${error.message}`);
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø®Ø·Ø£ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø§Ù†ØªØ¸Ø± ÙˆÙ‚Øª Ø£Ø·ÙˆÙ„ Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        await new Promise(r => setTimeout(r, 30000)); // Ø§Ù†ØªØ¸Ø§Ø± 30 Ø«Ø§Ù†ÙŠØ©
        continue;
      }
      
      await new Promise(r => setTimeout(r, 10000)); // ÙØ­Øµ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†Ù
    }
    
    // ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ: Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·ÙŠØ±Ø§Ù‹ Ø£Ùˆ ØªØ­Ø°ÙŠØ±ÙŠØ§Ù‹ Ø£Ùˆ Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø©
    if (trackedTokens[token] && (
        trackedTokens[token].rugcheckStatus === 'DANGER' || 
        trackedTokens[token].rugcheckStatus === 'WARNING' ||
        trackedTokens[token].lowLiquidity === true
    )) {
      console.log(`[${token}] ğŸ—‘ï¸ ØªÙ†Ø¸ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠ: Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©`);
      stopTrackingToken(token);
    }
  })();
}

// Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… API Ø§Ù„Ù…Ø­Ø³Ù†
async function startTrackingToken(token, rugcheckStatus = null, solValue = null) {
  if (trackedTokens[token]) {
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙˆÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯ØŒ ÙÙ‚Ø· Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© rugcheck Ùˆ solValue
    if (rugcheckStatus !== null) {
      trackedTokens[token].rugcheckStatus = rugcheckStatus;
    }
    if (solValue !== null) {
      trackedTokens[token].solValue = solValue;
    }
    saveTrackedTokens();
    return;
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
  const activeTokensCount = Object.keys(trackedTokens).filter(t => !trackedTokens[t].stopped).length;
  if (activeTokensCount >= MAX_TRACKED_TOKENS) {
    console.log(`âš ï¸ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (${MAX_TRACKED_TOKENS}). ØªØ®Ø·ÙŠ Ø§Ù„ØªÙˆÙƒÙ†: ${token}`);
    return;
  }
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
  const startTime = new Date();
  trackedTokens[token] = {
    token,
    name: null, // Ø§Ø³Ù… Ø§Ù„ØªÙˆÙƒÙ†
    symbol: null, // Ø±Ù…Ø² Ø§Ù„ØªÙˆÙƒÙ†
    startTime,
    firstPrice: null,
    lastPrice: null,
    maxIncrease: 0,
    reached50: false,
    stopped: false,
    rugcheckStatus: rugcheckStatus, // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚  rugcheck.xyz
    lowLiquidity: null, // Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠÙˆÙ„Ø©: true = Ù…Ù†Ø®ÙØ¶Ø©ØŒ false = Ø·Ø¨ÙŠØ¹ÙŠØ©ØŒ null = ØºÙŠØ± Ù…Ø­Ù‚Ù‚Ø©
    solValue: solValue, // Ù‚ÙŠÙ…Ø© SOL Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    // Ø®ØµØ§Ø¦Øµ Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    previousHighPrice: null,
    currentHighPrice: null,
    lastRiseTime: null,
    rapidRiseAchieved: false,
    priceRiseHistory: [], // Ù…ØµÙÙˆÙØ© Ù„Ø­ÙØ¸ ØªØ§Ø±ÙŠØ® Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    // Ø®ØµØ§Ø¦Øµ Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØªØ¨Ø¹ Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹
    highestPrice: null, // Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆØµÙ„ Ø¥Ù„ÙŠÙ‡ Ø§Ù„ØªÙˆÙƒÙ†
    maxRisePercentage: 0, // Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ø±ØªÙØ§Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„ ÙˆØ£Ø¹Ù„Ù‰ Ø³Ø¹Ø±
    priceHistoryEvery20s: [], // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ„ 20 Ø«Ø§Ù†ÙŠØ© Ù…Ø¹ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±
    lastPriceUpdate20s: null // Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø³Ø¹Ø± ÙƒÙ„ 20 Ø«Ø§Ù†ÙŠØ©
  };

  // Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯
  saveTrackedTokens();
  
  console.log(`[${token}] âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ù…Ù„Ù`);
  console.log(`[${token}] ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ† - Ø­Ø§Ù„Ø© rugcheck: ${rugcheckStatus || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}, SOL: ${solValue || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`);

  // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ±Ù…Ø²Ù‡ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
  fetchTokenInfo(token).catch(error => {
    console.error(`[${token}] ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙƒÙ†: ${error.message}`);
  });

  // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… API
  try {
    console.log(`[${token}] ğŸ¯ Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ„ 10 Ø«ÙˆØ§Ù†Ù...`);
    await startAPITracking(token, startTime);
  } catch (error) {
    console.error(`[${token}] ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±: ${error.message}`);
  }
}

// Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
function stopTrackingToken(token) {
  if (trackedTokens[token]) {
    trackedTokens[token].stopped = true;
    delete trackedTokens[token];
    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
    saveTrackedTokens();
    console.log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† ${token} Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©`);
  }
}

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø³ÙŠØ±ÙØ±
const PHONE_NUMBER = process.env.PHONE_NUMBER || "+967xxxxxxxxx";  // Ø¶Ø¹ Ø±Ù‚Ù…Ùƒ Ù‡Ù†Ø§
const PASSWORD = process.env.PASSWORD || "YOUR_PASSWORD"; // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± 2FA
const PHONE_CODE = process.env.PHONE_CODE || undefined; // ÙŠÙ…ÙƒÙ† ØªØ±ÙƒÙ‡ undefined Ù„ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡

const apiId = parseInt(process.env.API_ID) || 23299626;
const apiHash = process.env.API_HASH || "89de50a19288ec535e8b008ae2ff268d";

console.log("ğŸš€ Bot is now running 24/7 on the server!");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª ÙˆØ§Ù„Ø¨Ø¯Ø¡
loadTrackedTokens();
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©
loadSentTokens();
// Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©
startAutomaticDangerousTokenCleanup();
// Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ
startLiquidityCheck();

// Ø¯Ø§Ù„Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬
function logLoginLogout(type) {
  const logFile = 'login_logout_log.txt';
  const now = new Date().toISOString();
  fs.appendFileSync(logFile, `${type},${now}\n`, 'utf8');
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
logLoginLogout('login');

// Ù†Ø­Ø§ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù† Ù…Ù„Ù
let stringSession = new StringSession("");
let savedSessionData = "";

// Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù Ø§Ù„Ø¬Ù„Ø³Ø© ÙÙŠ Ù…ÙˆØ§Ù‚Ø¹ Ù…ØªØ¹Ø¯Ø¯Ø©
const sessionPaths = ["session.txt", "./render_package/session.txt"];
let sessionFound = false;

for (const sessionPath of sessionPaths) {
  if (fs.existsSync(sessionPath)) {
    savedSessionData = fs.readFileSync(sessionPath, "utf8").trim();
    if (savedSessionData && savedSessionData.length > 0) {
      stringSession = new StringSession(savedSessionData);
      console.log("ğŸ“ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø¬Ù„Ø³Ø© ÙÙŠ:", sessionPath, "Ø¨Ø­Ø¬Ù…:", savedSessionData.length, "Ø­Ø±Ù");
      sessionFound = true;
      break;
    }
  }
}

if (!sessionFound) {
  console.log("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø¬Ù„Ø³Ø© ØµØ§Ù„Ø­ ÙÙŠ Ø£ÙŠ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©");
}

(async () => {
  console.log("ğŸ“² Starting Telegram connection...");
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© ØµØ§Ù„Ø­Ø©
  const hasValidSession = savedSessionData && savedSessionData.length > 0;
  
  if (hasValidSession) {
    console.log("ğŸ” Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©...");
  } else {
    console.log("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ...");
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø§ØªØµØ§Ù„
  if (!hasValidSession && PHONE_NUMBER === "+967xxxxxxxxx") {
    console.warn("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© ØµØ§Ù„Ø­Ø© ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¯ÙˆÙ† ÙˆØ¸Ø§Ø¦Ù Telegram.");
    console.warn("âš ï¸ Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ¸Ø§Ø¦Ù TelegramØŒ ÙŠØ±Ø¬Ù‰ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© ØµØ§Ù„Ø­Ø©.");
    return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø¯Ø§Ù„Ø© Telegram ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…
  }

  const client = new TelegramClient(stringSession, apiId, apiHash, {
    connectionRetries: 5,
  });
  
  // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø®Ø±Ù‰
  globalClient = client;

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© ÙÙ‚Ø·
  try {
    if (hasValidSession) {
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙ‚Ø·
      await client.connect();
      console.log("âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©!");
    } else {
      await client.start({
        phoneNumber: async () => PHONE_NUMBER,
        password: async () => PASSWORD,
        phoneCode: async () => PHONE_CODE,
        onError: (err) => console.log("âŒ Ø®Ø·Ø£:", err),
      });
    }
  } catch (err) {
    if (err.errorMessage === 'AUTH_KEY_DUPLICATED') {
      console.error('âŒ AUTH_KEY_DUPLICATED: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©.');
      fs.unlinkSync('session.txt'); // Ø­Ø°Ù Ù…Ù„Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
      stringSession = new StringSession(""); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø©
      
      if (PHONE_NUMBER === "+967xxxxxxxxx") {
        console.warn("âš ï¸ ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¯ÙˆÙ† ÙˆØ¸Ø§Ø¦Ù Telegram.");
        return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø¯Ø§Ù„Ø© Telegram ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…
      }
      
      try {
        await client.start({
          phoneNumber: async () => PHONE_NUMBER,
          password: async () => PASSWORD,
          phoneCode: async () => PHONE_CODE,
          onError: (err) => console.log("âŒ Ø®Ø·Ø£:", err),
        });
      } catch (retryErr) {
        console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©:', retryErr.message);
        console.warn("âš ï¸ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¯ÙˆÙ† ÙˆØ¸Ø§Ø¦Ù Telegram.");
        return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø¯Ø§Ù„Ø© Telegram ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…
      }
    } else if (err.errorMessage === 'PHONE_NUMBER_BANNED') {
      console.error('âŒ PHONE_NUMBER_BANNED: Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø­Ø¸ÙˆØ±. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¢Ø®Ø± Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….');
      console.warn("âš ï¸ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¯ÙˆÙ† ÙˆØ¸Ø§Ø¦Ù Telegram.");
      return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø¯Ø§Ù„Ø© Telegram ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…
    } else {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', err.message);
      console.warn("âš ï¸ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¯ÙˆÙ† ÙˆØ¸Ø§Ø¦Ù Telegram.");
      return; // Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø¯Ø§Ù„Ø© Telegram ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù…
    }
  }

  try {
    console.log("âœ… Logged in!");
    const sessionString = client.session.save();

    // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© ÙÙŠ ÙƒÙ„Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ÙŠÙ† Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ§Ù„ÙŠ
    try {
      fs.writeFileSync("session.txt", sessionString);
      console.log("ğŸ’¾ Session saved to session.txt");
    } catch (err) {
      console.log("âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ session.txt:", err.message);
    }
    
    try {
      // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ render_package
      if (!fs.existsSync("render_package")) {
        fs.mkdirSync("render_package", { recursive: true });
      }
      fs.writeFileSync("render_package/session.txt", sessionString);
      console.log("ğŸ’¾ Session saved to render_package/session.txt");
    } catch (err) {
      console.log("âš ï¸ ØªØ¹Ø°Ø± Ø­ÙØ¸ render_package/session.txt:", err.message);
    }

    await client.sendMessage("me", { message: "ğŸš€ Ø¨ÙˆØª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø´ØºØ§Ù„!" });

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø©
    const joinedBotsFile = 'joined_bots.txt';
    if (!fs.existsSync(joinedBotsFile)) {
      try {
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        const botsToJoin = ['GMGN_sol_bot', 'solBigamout'];
        for (const bot of botsToJoin) {
          // Ø£Ø±Ø³Ù„ ÙÙ‚Ø· Ù„Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„ØªÙŠ ØªÙ†ØªÙ‡ÙŠ Ø¨Ù€ _bot
          if (bot.endsWith('_bot')) {
            await client.sendMessage(bot, { message: '/start' });
            await sleep(2000);
          } else {
            console.log(`âš ï¸ ØªØ®Ø·ÙŠ ${bot}: Ù„ÙŠØ³ Ø¨ÙˆØª ØªÙ„ÙŠØ¬Ø±Ø§Ù….`);
          }
        }
        fs.writeFileSync(joinedBotsFile, 'done');
        console.log('âœ… ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ÙƒÙ„ Ø§Ù„Ø¨ÙˆØªØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©.');
      } catch (err) {
        console.error('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¨ÙˆØªØ§Øª:', err.message);
      }
  }

  // Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡
  client.addEventHandler(async (update) => {
    try {
      // ØªØ¹Ø¯ÙŠÙ„ Ø´Ø±ÙˆØ· Ø§Ù„ÙÙ„ØªØ±Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±Ø² Ø§Ù„Ø±Ø§Ø¨Ø¹
      if (update.message && typeof update.message.message === "string") {

        const msg = update.message;
        const text = msg.message;

        // Ù…ÙŠØ²Ø© Ù…Ù†ÙØµÙ„Ø©: Ø¹Ù†Ø¯ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ FARESS Ø£Ø±Ø³Ù„ ØµÙØ­Ø© ØªØªØ¨Ø¹ Ø§Ù„ØªÙˆÙƒÙ† ÙƒÙ…Ù„Ù HTML Ø¥Ù„Ù‰ GMGN
        if (text.trim() === "FARESS") {
          const { fetchAndSaveTrackTokenPage } = require("./sendTrackTokenPage");
          const htmlFile = await fetchAndSaveTrackTokenPage();
          if (htmlFile) {
            try {
              await client.sendFile('GMGN_sol_bot', {
                file: htmlFile,
                caption: 'ğŸ“Š ØµÙØ­Ø© ØªØªØ¨Ø¹ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø·Ù„Ø¨ FARESS)'
              });
              console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØµÙØ­Ø© ØªØªØ¨Ø¹ Ø§Ù„ØªÙˆÙƒÙ† ÙƒÙ…Ù„Ù HTML Ø¥Ù„Ù‰ GMGN_sol_bot');
            } catch (err) {
              console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ GMGN_sol_bot:', err.message);
            }
          } else {
            console.error('âŒ ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø£Ùˆ Ø­ÙØ¸ ØµÙØ­Ø© ØªØªØ¨Ø¹ Ø§Ù„ØªÙˆÙƒÙ†');
          }
          return;
        }

        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "counts: 1" Ø£Ùˆ Ø£ÙƒØ«Ø± Ùˆ"25 SOL" Ø£Ùˆ Ø£ÙƒØ«Ø±
    // ØªØ¹Ø¯ÙŠÙ„ Ø´Ø±Ø· Ø§Ù„ÙØ±Ø² Ù„ÙŠÙƒÙˆÙ† Ù…Ù† "SOL 10.00" ÙˆØ£Ø¹Ù„Ù‰
    if (/\bcounts:\s*(\d+)\b/i.test(text) && parseInt(text.match(/\bcounts:\s*(\d+)\b/i)[1]) >= 1 &&
      /(1[0-9]|[2-9]\d|\d{3,})\.\d{2}\s*SOL(\D|$)/.test(text)) {

          // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‚ÙŠÙ…Ø© SOL Ù…Ù† Ø§Ù„Ù†Øµ
          const solMatch = text.match(/([\d,]+\.\d{2})\s*SOL/);
          let solValue = null;
          if (solMatch && solMatch[1]) {
            solValue = parseFloat(solMatch[1].replace(/,/g, ''));
            console.log(`ğŸ’° Extracted SOL value: ${solValue}`);
          }

          // ÙÙ„ØªØ±Ø© "5m" Ø¨Ø­ÙŠØ« ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0% Ùˆ 100000%
          const fiveMinMatch = text.match(/5m\s*\((\d+\.\d+)%\)/);
          if (fiveMinMatch) {
            const fiveMinPercentage = parseFloat(fiveMinMatch[1]);
            if (fiveMinPercentage < 0 || fiveMinPercentage > 100000) {
              console.log(`âš ï¸ 5m ratio (${fiveMinPercentage}%) outside required range (0%-100000%). Skipping.`);
              return;
            }
          }

          // Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… (d) ÙŠØ³Ø§ÙˆÙŠ 0
          const ageMatch = text.match(/age:\s*(\d+)d\s*(\d+)h/);
          if (ageMatch) {
            const days = parseInt(ageMatch[1]);
            if (days !== 0) {
              console.log(`âš ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… (d) Ù„ÙŠØ³ 0. ØªØ®Ø·ÙŠ.`);
              return;
            }
          }

          // ÙÙ„ØªØ±Ø© Ø§Ù„Ø³Ø¹Ø± price: $... ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 0.01
          const priceMatch = text.match(/price:\s*\$?([\deE\.-]+)/i);
          if (priceMatch && priceMatch[1]) {
            let priceValue = parseFloat(priceMatch[1]);
            if (isNaN(priceValue)) {
              // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ù† ØµÙŠØºØ© Ø¹Ù„Ù…ÙŠØ©
              try {
                priceValue = Number(priceMatch[1]);
              } catch {}
            }
            if (!(priceValue < 0.01)) {
              console.log(`âš ï¸ Price ${priceValue} is greater than or equal to 0.01. Skipping.`);
              return;
            }
          } else {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø³Ø¹Ø±ØŒ ØªØ®Ø·Ù‰
            console.log('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©. ØªØ®Ø·ÙŠ.');
            return;
          }

          const startTime = performance.now();
          // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ø¹Ø¯ ca:
          const caMatch = text.match(/ca:\s*([\w]+)/);
          if (caMatch && caMatch[1]) {
            const token = caMatch[1];
            if (sentTokens.has(token)) {
              console.log(`âš ï¸ Ø§Ù„ØªÙˆÙƒÙ† ${token} ØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù…Ø³Ø¨Ù‚Ù‹Ø§. ØªØ®Ø·ÙŠ.`);
              return;
            }
            
            // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø¹ Ù‚ÙŠÙ…Ø© SOL
            console.log(`${token} (${solValue ? solValue.toFixed(2) + ' SOL' : 'SOL ØºÙŠØ± Ù…Ø­Ø¯Ø¯'})`);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø¹Ù„Ù‰ rugcheck.xyz Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            console.log(`[${token}] ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø¹Ù„Ù‰ rugcheck.xyz...`);
            const tokenSafety = await checkTokenSafety(token);
            
            // Ø­ÙØ¸ Ø­Ø§Ù„Ø© rugcheck ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ø¹Ø±Ø¶ Ù„Ø§Ø­Ù‚Ø§Ù‹
            if (trackedTokens[token]) {
              trackedTokens[token].rugcheckStatus = tokenSafety;
            }
            
            // ÙØ­Øµ Ù†ØªÙŠØ¬Ø© rugcheck
            if (tokenSafety === 'DANGER') {
              console.log(`[${token}] âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªÙˆÙƒÙ† - Ù…ØµÙ†Ù ÙƒÙ€ DANGER Ø¹Ù„Ù‰ rugcheck.xyz`);
              console.log(`[${token}] ğŸš« Ù„Ù† ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ù„Ù‰ GMGN`);
              console.log(`[${token}] ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø®Ø·ÙŠØ± ÙÙˆØ±Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©`);
              
              // Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø®Ø·ÙŠØ± ÙÙˆØ±Ø§Ù‹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù…Ø±Ø§Ù‚Ø¨ØªÙ‡
              if (trackedTokens[token]) {
                stopTrackingToken(token);
              }
              
              return; // Ø¹Ø¯Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·Ø±
            } else if (tokenSafety === 'WARNING') {
              console.log(`[${token}] âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„ØªÙˆÙƒÙ† Ù…ØµÙ†Ù ÙƒÙ€ WARNING Ø¹Ù„Ù‰ rugcheck.xyz`);
              console.log(`[${token}] ğŸ¤” Ù„Ù† ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙƒØ¥Ø¬Ø±Ø§Ø¡ Ø§Ø­ØªØ±Ø§Ø²ÙŠ`);
              console.log(`[${token}] ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠ ÙÙˆØ±Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©`);
              
              // Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠ ÙÙˆØ±Ø§Ù‹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ù…Ø±Ø§Ù‚Ø¨ØªÙ‡
              if (trackedTokens[token]) {
                stopTrackingToken(token);
              } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©ØŒ Ù„Ø§ Ù†Ø¶ÙŠÙÙ‡ Ø£ØµÙ„Ø§Ù‹
                console.log(`[${token}] Ø§Ù„ØªÙˆÙƒÙ† Ù„ÙŠØ³ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©ØŒ Ù„Ù† ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡`);
              }
              
              // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø­ØªÙ‰ Ù„Ùˆ ØªÙ… Ø±ÙØ¶Ù‡ (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª)
              startTrackingToken(token, tokenSafety, solValue).catch(err => {
                console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: ${err.message}`);
              });
              
              return; // Ø¹Ø¯Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ­Ø°ÙŠØ±
            } else if (tokenSafety === 'GOOD') {
              console.log(`[${token}] âœ… Ø§Ù„ØªÙˆÙƒÙ† Ø¢Ù…Ù† Ø¹Ù„Ù‰ rugcheck.xyz`);
            } else {
              // Ø¥Ø°Ø§ ÙƒØ§Ù† UNKNOWN Ø£Ùˆ Ø£ÙŠ Ø­Ø§Ù„Ø© Ø£Ø®Ø±Ù‰
              console.log(`[${token}] âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø¨ÙˆØ¶ÙˆØ­ Ø¹Ù„Ù‰ rugcheck.xyz (Ø§Ù„Ø­Ø§Ù„Ø©: ${tokenSafety})`);
              console.log(`[${token}] ğŸ›‘ Ù„Ù† ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„Ø£Ù† Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø© - Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø­ØªØ±Ø§Ø²ÙŠ`);
              
              // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø­ØªÙ‰ Ù„Ùˆ ØªÙ… Ø±ÙØ¶Ù‡ (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª)
              startTrackingToken(token, tokenSafety, solValue).catch(err => {
                console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: ${err.message}`);
              });
              
              return; // Ø¹Ø¯Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø©
            }
            
            console.log(`[${token}] â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù‚Ù‚ Ø´Ø±Ø· Ø§Ù„Ù€ 50% Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙˆÙƒÙ† Ø¥Ù„Ù‰ GMGN`);
            
            // Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ù…Ù„Ù Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø¨ÙˆØª sniperoo
            fs.writeFileSync('last_token.txt', token, 'utf8');

            // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ
            // Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙˆÙƒÙ† ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªØ­Ù‚Ù‚ Ø§Ù„Ù€ 50% Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙˆÙƒÙ† Ø¢Ù…Ù† (GOOD)
            if (tokenSafety === 'GOOD') {
              console.log(`[${token}] ğŸ”„ Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø¢Ù…Ù† Ù„Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù‚Ù‚ Ø§Ù„Ù€ 50%...`);
              console.log(`[${token}] â³ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ 50% Ø§Ø±ØªÙØ§Ø¹`);
              
              // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ† (Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)
              startTrackingToken(token, tokenSafety, solValue).catch(err => {
                console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: ${err.message}`);
              }).then(() => {
                console.log(`[${token}] âœ… ØªÙ… Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ù†Ø¬Ø§Ø­ - Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ„ 10 Ø«ÙˆØ§Ù†Ù`);
              });
            } else {
              console.log(`[${token}] ğŸ›‘ ØªÙ… ØªØ®Ø·ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„ØªÙˆÙƒÙ† Ø¨Ø³Ø¨Ø¨ Ø£Ù† Ø­Ø§Ù„Ø© rugcheck Ù„ÙŠØ³Øª Ø¢Ù…Ù†Ø© (Ø§Ù„Ø­Ø§Ù„Ø©: ${tokenSafety})`);
              // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ† Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ÙŠÙƒÙ† Ø¢Ù…Ù†Ù‹Ø§ (Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª) Ù…Ø¹ ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
              startTrackingToken(token, tokenSafety, solValue).catch(err => {
                console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: ${err.message}`);
              });
            }

            const endTime = performance.now();
            const executionTimeLog = `â±ï¸ ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ° Ù„Ù„ØªÙˆÙƒÙ† ${token}: ${(endTime - startTime).toFixed(2)} Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©.`;
            console.log(executionTimeLog);
            executionLogsBuffer.push(`${executionTimeLog}\n`);
          }
        }
      }
    } catch (err) {
      console.error("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡:", err.message);
    }
  });
  
  } catch (telegramError) {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Telegram:", telegramError.message);
    console.warn("âš ï¸ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¯ÙˆÙ† ÙˆØ¸Ø§Ø¦Ù Telegram.");
  }
})().catch(err => {
  console.error("âŒ Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Telegram:", err.message);
  console.warn("âš ï¸ Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¯ÙˆÙ† ÙˆØ¸Ø§Ø¦Ù Telegram.");
});

const botUsername = 'GMGN_sol_bot';

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø¨ÙˆØª GMGN
async function tradeInGMGNBot(client, token) {
  const lastStartFile = 'gmgn_last_start.txt';
  let shouldSendStart = true;
  try {
    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¢Ø®Ø± Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ /start
    if (fs.existsSync(lastStartFile)) {
      const lastStartDate = fs.readFileSync(lastStartFile, 'utf8').trim();
      const today = new Date().toISOString().slice(0, 10);
      if (lastStartDate === today) {
        shouldSendStart = false;
      }
    }
    // Ø¥Ø±Ø³Ø§Ù„ /start Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙŠÙˆÙ…ÙŠØ§Ù‹
    if (shouldSendStart) {
      await client.sendMessage(botUsername, { message: '/start' });
      fs.writeFileSync(lastStartFile, new Date().toISOString().slice(0, 10));
      await sleep(2000);
    }
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ†
    await client.sendMessage(botUsername, { message: token });
    await sleep(3000);

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¨ÙˆØª ÙˆØ·Ø¨Ø§Ø¹Ø© ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø¹Ø±
    let price = null;
    let done = false;
    let lastBotMessage = null;
    const handler = async (update) => {
      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø¨ÙˆØª GMGN Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ peerId
      if (update.message && update.message.peerId && (
            (update.message.peerId.userId && update.message.peerId.userId.toString().includes('GMGN')) ||
            (update.message.peerId.channelId && botUsername.includes('GMGN'))
          )) {
        const text = update.message.message;
        lastBotMessage = text;
        // ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        if (text.includes(token)) {
          // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©
          let priceMatch = text.match(/price:\s*\$?([\d\.]+)/i);
          if (priceMatch && priceMatch[1]) {
            price = parseFloat(priceMatch[1]);
            done = true;
            // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø³Ø¹Ø± ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±
            console.log('ğŸ“© Ø§Ù„Ø³Ø¹Ø± Ù…Ù† GMGN: ' + priceMatch[1]);
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø²ÙŠØ§Ø¯Ø© 1000%
            const newPrice = (price * 10).toFixed(6);
            // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
            const orderMsg = `/create limitbuy ${token} 0.5@${newPrice} -exp 86400`;
            await client.sendMessage(botUsername, { message: orderMsg });
            console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„ØªØ¯Ø§ÙˆÙ„:', orderMsg);
          } else {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø³Ø¹Ø±ØŒ Ø§Ø·Ø¨Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙƒØ§Ù…Ù„Ø©
            console.log('ğŸ“© Ø±Ø³Ø§Ù„Ø© Ù…Ù† GMGN:\n' + text);
          }
        }
      }
    };
    client.addEventHandler(handler);
    // Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø³Ø¹Ø± Ø£Ùˆ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù„Ø©
    let tries = 0;
    while (!done && tries < 10) {
      await sleep(1000);
      tries++;
    }
    client.removeEventHandler(handler);
    if (!price) {
      console.log('ğŸ“© Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª Ø¨Ø¹Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ†:\n' + (lastBotMessage || 'Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ø¨ÙˆØª Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ†'));
      return;
    }
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø²ÙŠØ§Ø¯Ø© 1000%
    const newPrice = (price * 10).toFixed(6);
    // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„ØªØ¯Ø§ÙˆÙ„
    const orderMsg = `/create limitbuy ${token} 0.5@${newPrice} -exp 86400`;
    await client.sendMessage(botUsername, { message: orderMsg });
    console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„ØªØ¯Ø§ÙˆÙ„:', orderMsg);
  } catch (err) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù…Ø¹ GMGN:', err.message);
  }
}

// Ø¯Ø§Ù„Ø© ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·Ø©
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© ÙƒÙ„ Ø³Ø§Ø¹Ø©
function startAutoDeletion() {
  console.log('ğŸ¤– Automatic deletion of dangerous and warning tokens enabled every hour');
  
  // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø© (3600000 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
  setInterval(async () => {
    console.log('â° Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©...');
    const result = await deleteDangerousTokens();
    
    if (result.deleted > 0) {
      console.log(`ğŸ§¹ ØªÙ… Ø­Ø°Ù ${result.deleted} ØªÙˆÙƒÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø¹Ù…Ù„ÙŠØ© ØªÙ†Ø¸ÙŠÙ Ø¯ÙˆØ±ÙŠØ©)`);
    } else {
      console.log('âœ¨ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙƒÙ†Ø§Øª Ø®Ø·ÙŠØ±Ø© Ù„Ù„Ø­Ø°Ù ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆØ±Ø©');
    }
  }, 3600000); // ÙƒÙ„ Ø³Ø§Ø¹Ø©
  
  // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ø¯ÙˆØ±Ø© Ø­Ø°Ù Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ù„Ø³ÙŠØ±ÙØ±
  setTimeout(async () => {
    console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ø­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„ØªØ´ØºÙŠÙ„...');
    const result = await deleteDangerousTokens();
    
    if (result.deleted > 0) {
      console.log(`ğŸ§¹ ØªÙ… Ø­Ø°Ù ${result.deleted} ØªÙˆÙƒÙ† ÙÙŠ Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© ØªÙ†Ø¸ÙŠÙ`);
    }
  }, 3600000); // Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©
}

// Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡Ø§
async function recheckOldTokens() {
  console.log('ğŸ” Starting re-checking of old configurations...');
  
  const tokenEntries = Object.entries(trackedTokens);
  const uncheckedTokens = tokenEntries.filter(([token, data]) => 
    !data.rugcheckStatus || data.rugcheckStatus === null || data.rugcheckStatus === 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' || data.rugcheckStatus === 'UNKNOWN'
  );
  
  if (uncheckedTokens.length === 0) {
    console.log('âœ… All configurations are up to date and do not need re-checking');
    return;
  }
  
  console.log(`ğŸ“‹ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${uncheckedTokens.length} ØªÙˆÙƒÙ† ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ`);
  
  for (const [token, data] of uncheckedTokens) {
    console.log(`ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ†: ${token}`);
    
    try {
      const newStatus = await checkTokenSafety(token);
      trackedTokens[token].rugcheckStatus = newStatus;
      
      console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ${token} Ø¥Ù„Ù‰: ${newStatus}`);
      
      // Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© ÙÙˆØ±Ø§Ù‹
      if (newStatus === 'DANGER' || newStatus === 'WARNING') {
        console.log(`[${token}] ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† ${newStatus === 'DANGER' ? 'Ø§Ù„Ø®Ø·ÙŠØ±' : 'Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠ'} ÙÙˆØ±Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©`);
        stopTrackingToken(token);
        continue; // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ§Ù„ÙŠ
      }
      
      // Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ ÙØ­Øµ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø²Ø§Ø¦Ø¯
      await new Promise(resolve => setTimeout(resolve, 2000));
      
    } catch (error) {
      console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ ${token}: ${error.message}`);
    }
  }
  
  // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
  saveTrackedTokens();
  console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª');
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚ÙØ©
async function restartAllTokens() {
  console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚ÙØ©...');
  
  const tokenEntries = Object.entries(trackedTokens);
  const stoppedTokens = tokenEntries.filter(([token, data]) => data.stopped === true);
  
  if (stoppedTokens.length === 0) {
    console.log('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙƒÙ†Ø§Øª Ù…ØªÙˆÙ‚ÙØ© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„Ù‡Ø§');
    return;
  }
  
  console.log(`ğŸ”„ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${stoppedTokens.length} ØªÙˆÙƒÙ† Ù…ØªÙˆÙ‚Ù Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„Ù‡`);
  
  for (const [token, data] of stoppedTokens) {
    console.log(`ğŸš€ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†: ${token}`);
    
    try {
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙ†
      trackedTokens[token].stopped = false;
      trackedTokens[token].lowLiquidity = false; // Ø§ÙØªØ±Ø§Ø¶ Ø³ÙŠÙˆÙ„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
      trackedTokens[token].lastPrice = null; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¢Ø®Ø± Ø³Ø¹Ø±
      
      // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
      await startAPITracking(token, data.startTime).catch(err => {
        console.error(`[${token}] Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: ${err.message}`);
        startManualTracking(token);
      });
      
      console.log(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù„Ù„ØªÙˆÙƒÙ†: ${token}`);
      
      // Ø§Ù†ØªØ¸Ø§Ø± Ù‚ØµÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø²Ø§Ø¦Ø¯
      await new Promise(resolve => setTimeout(resolve, 1000));
      
    } catch (error) {
      console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ ${token}: ${error.message}`);
    }
  }
  
  // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
  saveTrackedTokens();
  console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©');
}

// Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©
async function deleteDangerousTokens() {
  console.log('ğŸ” ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©...');
  
  const tokenEntries = Object.entries(trackedTokens);
  const dangerousTokens = tokenEntries.filter(([token, data]) => 
    data.rugcheckStatus === 'DANGER' || data.rugcheckStatus === 'WARNING'
  );
  
  if (dangerousTokens.length === 0) {
    console.log('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙƒÙ†Ø§Øª Ø®Ø·ÙŠØ±Ø© Ø£Ùˆ ØªØ­Ø°ÙŠØ±ÙŠØ©');
    return { deleted: 0, total: tokenEntries.length };
  }
  
  console.log(`ğŸ—‘ï¸ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${dangerousTokens.length} ØªÙˆÙƒÙ† Ø®Ø·ÙŠØ±/ØªØ­Ø°ÙŠØ±ÙŠ - Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ø°Ù...`);
  
  let deletedCount = 0;
  for (const [token, data] of dangerousTokens) {
    try {
      console.log(`ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† ${data.rugcheckStatus}: ${token}`);
      delete trackedTokens[token];
      deletedCount++;
    } catch (error) {
      console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† ${token}: ${error.message}`);
    }
  }
  
  // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
  if (deletedCount > 0) {
    saveTrackedTokens();
    console.log(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} ØªÙˆÙƒÙ† Ø®Ø·ÙŠØ±/ØªØ­Ø°ÙŠØ±ÙŠ`);
  }
  
  return { deleted: deletedCount, total: tokenEntries.length };
}

// Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©
function startAutomaticDangerousTokenCleanup() {
  console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©...');
  setInterval(async () => {
    try {
      const result = await deleteDangerousTokens();
      if (result.deleted > 0) {
        console.log(`ğŸ§¹ ØªÙ… Ø­Ø°Ù ${result.deleted} ØªÙˆÙƒÙ† Ø®Ø·ÙŠØ±/ØªØ­Ø°ÙŠØ±ÙŠ`);
      }
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error.message);
    }
  }, 60000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
  
  console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©)');
}

// ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª
function startLiquidityCheck() {
  console.log('ğŸ’§ Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª...');
  setInterval(async () => {
    try {
      await checkAllTokensLiquidity();
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ:', error.message);
    }
  }, 120000); // ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ† (120 Ø«Ø§Ù†ÙŠØ©)
  
  console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠ (ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†)');
}

// ÙØ­Øµ Ø³ÙŠÙˆÙ„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
async function checkAllTokensLiquidity() {
  const activeTokens = Object.keys(trackedTokens).filter(token => 
    !trackedTokens[token].stopped && 
    (trackedTokens[token].lowLiquidity === null || !trackedTokens[token].rugcheckStatus || trackedTokens[token].rugcheckStatus === 'UNKNOWN')
  );
  
  if (activeTokens.length === 0) {
    console.log('ğŸ’§ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙƒÙ†Ø§Øª ØªØ­ØªØ§Ø¬ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø£Ùˆ rugcheck');
    return;
  }
  
  console.log(`ğŸ’§ Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ùˆ rugcheck Ù„Ù€ ${activeTokens.length} ØªÙˆÙƒÙ†...`);
  
  // ÙØ­Øµ ÙƒÙ„ ØªÙˆÙƒÙ† Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ ÙˆØ§Ø­Ø¯
  for (let i = 0; i < activeTokens.length; i++) {
    const token = activeTokens[i];
    
    try {
      console.log(`ğŸ’§ ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ† ${i + 1}/${activeTokens.length}: ${token}`);
      
      // ÙØ­Øµ rugcheck Ø£ÙˆÙ„Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ÙØ­ØµÙ‡
      if (!trackedTokens[token].rugcheckStatus || trackedTokens[token].rugcheckStatus === 'UNKNOWN') {
        console.log(`[${token}] ğŸ” ÙØ­Øµ rugcheck...`);
        const rugcheckResult = await checkRugcheckSimple(token);
        if (trackedTokens[token]) {
          trackedTokens[token].rugcheckStatus = rugcheckResult;
          saveTrackedTokens();
          
          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·ÙŠØ± Ø£Ùˆ ØªØ­Ø°ÙŠØ±ÙŠØŒ Ø§Ø­Ø°ÙÙ‡ ÙÙˆØ±Ø§Ù‹
          if (rugcheckResult === 'DANGER' || rugcheckResult === 'WARNING') {
            console.log(`[${token}] ğŸ—‘ï¸ rugcheck ${rugcheckResult} - Ø­Ø°Ù ÙÙˆØ±ÙŠ`);
            stopTrackingToken(token);
            continue; // Ø§Ù†ØªÙ‚Ù„ Ù„Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ§Ù„ÙŠ
          }
        }
      }
      
      // ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙÙØ­Øµ Ù…Ù† Ù‚Ø¨Ù„
      if (trackedTokens[token] && trackedTokens[token].lowLiquidity === null) {
        await checkSingleTokenLiquidity(token);
      }
      
      // ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† ÙƒÙ„ ØªÙˆÙƒÙ† Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯
      if (i < activeTokens.length - 1) {
        await new Promise(resolve => setTimeout(resolve, 5000)); // 5 Ø«ÙˆØ§Ù†
      }
    } catch (error) {
      console.error(`ğŸ’§ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ† ${token}: ${error.message}`);
    }
  }
  
  console.log(`ğŸ’§ Ø§Ù†ØªÙ‡Ù‰ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ùˆ rugcheck Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª`);
}

// ÙØ­Øµ rugcheck Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ø¨Ø³Ø·Ø©
// ÙØ­Øµ rugcheck Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… rugcheck_content_extractor.js
async function checkRugcheckSimple(token) {
  try {
    console.log(`[${token}] ğŸ” ÙØ­Øµ rugcheck Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… content extractor...`);
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… rugcheck_content_extractor.js
    const RugcheckContentExtractor = require('./rugcheck_content_extractor');
    const extractor = new RugcheckContentExtractor();
    
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø³Ù‚
    const formattedContent = await extractor.extractFormattedContent(token);
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬
    const scoreMatch = formattedContent.match(/(\d+)\s*\/\s*100/);
    
    if (scoreMatch) {
      const score = parseInt(scoreMatch[1]);
      console.log(`[${token}] ğŸ“Š Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©: ${score}/100`);
      
      // ØªØµÙ†ÙŠÙ Ø§Ù„ØªÙˆÙƒÙ† Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
      let status;
      if (score >= 10 && score <= 20) {
        status = 'SAFE';
        console.log(`[${token}] âœ… Ø§Ù„ØªÙˆÙƒÙ† Ø¢Ù…Ù† - Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}/100`);
      } else if (score > 20 && score < 35) {
        status = 'WARNING';
        console.log(`[${token}] âš ï¸ Ø§Ù„ØªÙˆÙƒÙ† ØªØ­Ø°ÙŠØ±ÙŠ - Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}/100`);
      } else if (score >= 35) {
        status = 'DANGER';
        console.log(`[${token}] ğŸ”´ Ø§Ù„ØªÙˆÙƒÙ† Ø®Ø·Ø± - Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}/100`);
      } else {
        // Ø£Ù‚Ù„ Ù…Ù† 10 Ù†Ù‚Ø§Ø· - Ù†Ø¹ØªØ¨Ø±Ù‡ Ø¢Ù…Ù† Ø¬Ø¯Ø§Ù‹
        status = 'SAFE';
        console.log(`[${token}] âœ… Ø§Ù„ØªÙˆÙƒÙ† Ø¢Ù…Ù† Ø¬Ø¯Ø§Ù‹ - Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}/100`);
      }
      
      return status;
    } else {
      console.log(`[${token}] âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ… Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰`);
      return 'UNKNOWN';
    }
    
  } catch (error) {
    console.error(`[${token}] âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ rugcheck: ${error.message}`);
    return 'UNKNOWN';
  }
}

// ÙØ­Øµ Ø³ÙŠÙˆÙ„Ø© ØªÙˆÙƒÙ† ÙˆØ§Ø­Ø¯ (Ù…Ø¨Ø³Ø·)
async function checkSingleTokenLiquidity(token) {
  if (!trackedTokens[token] || trackedTokens[token].stopped) {
    return;
  }
  
  try {
    console.log(`[${token}] ğŸ’§ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù…Ù† API...`);
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù„ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© (ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    // Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ Ø³Ù†Ø¹ØªØ¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ù„Ø¯ÙŠÙ‡Ø§ Ø³ÙŠÙˆÙ„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© Ù…Ø§ Ù„Ù… Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø®Ø±Ù‰
    
    if (trackedTokens[token]) {
      // Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ùˆ Ø§Ø¹ØªØ¨Ø± Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…Ø­Ø¯Ø¯Ø©
      if (trackedTokens[token].lowLiquidity === undefined) {
        trackedTokens[token].lowLiquidity = false;
        console.log(`[${token}] ğŸ’§ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©: âœ… Ø§ÙØªØ±Ø§Ø¶ Ø·Ø¨ÙŠØ¹ÙŠØ© (Ù„Ù… ÙŠØªÙ… ÙØ­ØµÙ‡Ø§)`);
        saveTrackedTokens();
      }
    }
    
  } catch (error) {
    console.log(`[${token}] Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©: ${error.message}`);
  }
}

let buyPrice = 0.5; // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ

const PORT = process.env.PORT || 10000;
const server = http.createServer(async (req, res) => {
  // Health check endpoint Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Render
  if (req.method === "GET" && req.url === "/health") {
    res.writeHead(200, { "Content-Type": "application/json" });
    res.end(JSON.stringify({ status: "OK", timestamp: new Date().toISOString() }));
    return;
  }

  // Ping endpoint Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø¯Ù…Ø©
  if (req.method === "GET" && req.url === "/ping") {
    res.writeHead(200, { "Content-Type": "text/plain" });
    res.end("pong");
    return;
  }

  // Status endpoint Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø¯Ù…Ø©
  if (req.method === "GET" && req.url === "/status") {
    res.writeHead(200, { "Content-Type": "application/json" });
    res.end(JSON.stringify({ 
      status: "running", 
      port: PORT,
      timestamp: new Date().toISOString(),
      tracked_tokens: Object.keys(trackedTokens).length
    }));
    return;
  }

  // Root endpoint Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª
  if (req.method === "GET" && req.url === "/") {
    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <div style='text-align:center; font-family: Arial, sans-serif; padding: 50px;'>
        <h1 style='color: #0078D7;'>ğŸš€ Ø§Ù„Ø¨ÙˆØª ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!</h1>
        <p style='font-size: 1.2em; color: #333;'>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ: ${new Date().toLocaleString('ar-SA')}</p>
        <p><a href="/track_token" style='color: #0078D7; text-decoration: none;'>ğŸ“Š Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª</a></p>
        <p><a href="/add-test-token" style='color: #4CAF50; text-decoration: none; background: #f0f8ff; padding: 10px 20px; border-radius: 5px; display: inline-block; margin: 10px;'>ğŸ§ª Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† ØªØ¬Ø±ÙŠØ¨ÙŠ (SOL)</a></p>
        <div style='margin-top: 30px; background: #f8f9fa; padding: 20px; border-radius: 10px; max-width: 500px; margin: 30px auto;'>
          <h3 style='color: #333; margin-bottom: 15px;'>â• Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</h3>
          <form method="POST" action="/add-token" style='display: flex; flex-direction: column; gap: 10px;'>
            <input type="text" name="token" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆÙƒÙ† (Solana Address)" required 
                   style='padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: monospace;'>
            <input type="number" name="solValue" placeholder="Ù‚ÙŠÙ…Ø© SOL (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" step="0.01" min="0"
                   style='padding: 10px; border: 1px solid #ddd; border-radius: 5px;'>
            <button type="submit" style='background: #4CAF50; color: white; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;'>
              ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
            </button>
          </form>
        </div>
      </div>
    `);
    return;
  }

  // Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
  if (req.method === "POST" && req.url === "/add-token") {
    let body = "";
    req.on("data", chunk => {
      body += chunk.toString();
    });
    req.on("end", async () => {
      try {
        const params = new URLSearchParams(body);
        const token = params.get("token")?.trim();
        const solValue = params.get("solValue") ? parseFloat(params.get("solValue")) : null;
        
        if (!token) {
          res.writeHead(400, { "Content-Type": "text/html; charset=utf-8" });
          res.end(`
            <html>
            <head><title>Ø®Ø·Ø£</title><meta charset="utf-8"></head>
            <body style="font-family: Arial; text-align: center; padding: 50px;">
              <h2 style="color: #F44336;">âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆÙƒÙ†</h2>
              <a href="/" style="color: #0078D7; text-decoration: none;">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
            </body>
            </html>
          `);
          return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆÙƒÙ† (Solana address)
        if (token.length < 32 || token.length > 44) {
          res.writeHead(400, { "Content-Type": "text/html; charset=utf-8" });
          res.end(`
            <html>
            <head><title>Ø®Ø·Ø£</title><meta charset="utf-8"></head>
            <body style="font-family: Arial; text-align: center; padding: 50px;">
              <h2 style="color: #F44336;">âŒ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ­ÙŠØ­</h2>
              <p>ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù†ÙˆØ§Ù† Solana Ø¨ÙŠÙ† 32-44 Ø­Ø±Ù</p>
              <a href="/" style="color: #0078D7; text-decoration: none;">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
            </body>
            </html>
          `);
          return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø³Ø¨Ù‚Ø§Ù‹
        if (trackedTokens[token]) {
          res.writeHead(400, { "Content-Type": "text/html; charset=utf-8" });
          res.end(`
            <html>
            <head><title>ØªØ­Ø°ÙŠØ±</title><meta charset="utf-8"></head>
            <body style="font-family: Arial; text-align: center; padding: 50px;">
              <h2 style="color: #FF9800;">âš ï¸ Ø§Ù„ØªÙˆÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</h2>
              <a href="/track_token" style="color: #0078D7; text-decoration: none;">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª</a>
            </body>
            </html>
          `);
          return;
        }

        // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªÙˆÙƒÙ†
        console.log(`ğŸ“¥ Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©: ${token}${solValue ? ` (${solValue} SOL)` : ''}`);
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
        await startTrackingToken(token, null, solValue);
        
        res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
        res.end(`
          <html>
          <head>
            <title>ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­</title>
            <meta charset="utf-8">
            <meta http-equiv="refresh" content="3;url=/track_token">
          </head>
          <body style="font-family: Arial; text-align: center; padding: 50px;">
            <h2 style="color: #4CAF50;">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ù†Ø¬Ø§Ø­!</h2>
            <p><strong>Ø§Ù„ØªÙˆÙƒÙ†:</strong> ${token}</p>
            ${solValue ? `<p><strong>Ù‚ÙŠÙ…Ø© SOL:</strong> ${solValue}</p>` : ''}
            <p>Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©...</p>
            <p>Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø®Ù„Ø§Ù„ 3 Ø«ÙˆØ§Ù†Ù</p>
            <a href="/track_token" style="color: #0078D7; text-decoration: none;">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</a>
          </body>
          </html>
        `);
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ†:', error.message);
        res.writeHead(500, { "Content-Type": "text/html; charset=utf-8" });
        res.end(`
          <html>
          <head><title>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…</title><meta charset="utf-8"></head>
          <body style="font-family: Arial; text-align: center; padding: 50px;">
            <h2 style="color: #F44336;">âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
            <p>${error.message}</p>
            <a href="/" style="color: #0078D7; text-decoration: none;">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
          </body>
          </html>
        `);
      }
    });
    return;
  }

  // Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
  if (req.method === "GET" && req.url === "/add-test-token") {
    try {
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙˆÙƒÙ† SOL ÙƒÙ…Ø«Ø§Ù„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
      const testToken = "So11111111111111111111111111111111111111112"; // Ø¹Ù†ÙˆØ§Ù† SOL
      
      if (trackedTokens[testToken]) {
        res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
        res.end(`
          <html>
          <head><title>ØªÙˆÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯</title><meta charset="utf-8"></head>
          <body style="font-family: Arial; text-align: center; padding: 50px;">
            <h2 style="color: #FF9800;">âš ï¸ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹</h2>
            <a href="/track_token" style="color: #0078D7; text-decoration: none;">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª</a>
          </body>
          </html>
        `);
        return;
      }

      console.log(`ğŸ§ª Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${testToken}`);
      await startTrackingToken(testToken, null, 15.0);
      
      res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <html>
        <head>
          <title>ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ</title>
          <meta charset="utf-8">
          <meta http-equiv="refresh" content="3;url=/track_token">
        </head>
        <body style="font-family: Arial; text-align: center; padding: 50px;">
          <h2 style="color: #4CAF50;">âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªÙˆÙƒÙ† ØªØ¬Ø±ÙŠØ¨ÙŠ (SOL) Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±!</h2>
          <p><strong>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆÙƒÙ†:</strong> ${testToken}</p>
          <p><strong>Ù‚ÙŠÙ…Ø© SOL:</strong> 15.0</p>
          <p>Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©...</p>
          <p>Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø®Ù„Ø§Ù„ 3 Ø«ÙˆØ§Ù†Ù</p>
          <a href="/track_token" style="color: #0078D7; text-decoration: none;">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</a>
        </body>
        </html>
      `);
      
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ:', error.message);
      res.writeHead(500, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <html>
        <head><title>Ø®Ø·Ø£</title><meta charset="utf-8"></head>
        <body style="font-family: Arial; text-align: center; padding: 50px;">
          <h2 style="color: #F44336;">âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ</h2>
          <p>${error.message}</p>
          <a href="/" style="color: #0078D7; text-decoration: none;">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø©</a>
        </body>
        </html>
      `);
    }
    return;
  }

  if (req.method === "POST" && req.url === "/delete-all") {
    // Ù…Ø³Ø­ Ù…Ø­ØªÙˆÙŠØ§Øª Ù…Ù„Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª
    fs.writeFileSync('execution_logs.txt', '', 'utf8');
    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <div style='text-align:center;'>
        <div style='font-size:2em;'>ğŸš€ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!</div>
        <a href="/" style='font-size:1.5em; color:#0078D7;'>Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>
    `);
    return;
  }

  if (req.method === "POST" && req.url === "/delete-token") {
    let body = "";
    req.on("data", chunk => {
      body += chunk.toString();
    });
    req.on("end", () => {
      try {
        const data = JSON.parse(body);
        const token = data.token;
        
        if (!token) {
          res.writeHead(400, { "Content-Type": "application/json; charset=utf-8" });
          res.end(JSON.stringify({ success: false, error: "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙˆÙƒÙ†" }));
          return;
        }

        if (trackedTokens[token]) {
          // Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
          delete trackedTokens[token];
          saveTrackedTokens();
          console.log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† ${token} Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹`);
          
          res.writeHead(200, { "Content-Type": "application/json; charset=utf-8" });
          res.end(JSON.stringify({ success: true, message: "ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ø¨Ù†Ø¬Ø§Ø­" }));
        } else {
          res.writeHead(404, { "Content-Type": "application/json; charset=utf-8" });
          res.end(JSON.stringify({ success: false, error: "Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯" }));
        }
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†:', error.message);
        res.writeHead(500, { "Content-Type": "application/json; charset=utf-8" });
        res.end(JSON.stringify({ success: false, error: "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…" }));
      }
    });
    return;
  }

  if (req.method === "POST" && req.url === "/update-price") {
    let body = "";
    req.on("data", chunk => {
      body += chunk.toString();
    });
    req.on("end", () => {
      const params = new URLSearchParams(body);
      const newPrice = parseFloat(params.get("price"));
      if (!isNaN(newPrice) && newPrice > 0) {
        buyPrice = newPrice;
        res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
        res.end(`
          <div style='text-align:center;'>
            <div style='font-size:2em;'>âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰: ${buyPrice}</div>
            <a href="/" style='font-size:1.5em; color:#0078D7;'>Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          </div>
        `);
      } else {
        res.writeHead(400, { "Content-Type": "text/html; charset=utf-8" });
        res.end(`
          <div style='text-align:center;'>
            <div style='font-size:2em; color:red;'>âŒ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¯Ø®Ù„ ØºÙŠØ± ØµØ§Ù„Ø­!</div>
            <a href="/" style='font-size:1.5em; color:#0078D7;'>Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          </div>
        `);
      }
    });
    return;
  }

  // endpoint Ù„Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
  if (req.method === "POST" && req.url === "/recheck_tokens") {
    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <html lang="ar">
      <head>
        <title>Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª</title>
        <meta http-equiv="refresh" content="5; url=/track_token">
        <style>
          body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
          .loading { color: #0078D7; font-size: 18px; margin: 20px 0; }
        </style>
      </head>
      <body>
        <h2>ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª...</h2>
        <div class="loading">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ 5 Ø«ÙˆØ§Ù†Ù</div>
      </body>
      </html>
    `);
    
    // ØªØ´ØºÙŠÙ„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    recheckOldTokens().catch(error => {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª:', error.message);
    });
    
    return;
  }

  // endpoint Ù„Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ rugcheck Ù„ØªÙˆÙƒÙ† Ù…Ø­Ø¯Ø¯
  if (req.method === "GET" && req.url.startsWith("/recheck_rugcheck/")) {
    const token = req.url.split("/recheck_rugcheck/")[1];
    
    if (!token || !trackedTokens[token]) {
      res.writeHead(404, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Ø®Ø·Ø£</title>
          <meta charset="utf-8">
        </head>
        <body style="font-family: Arial; text-align: center; margin: 50px;">
          <h2>âŒ Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</h2>
          <a href="/">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </body>
        </html>
      `);
      return;
    }

    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ rugcheck</title>
        <meta charset="utf-8">
        <meta http-equiv="refresh" content="3;url=/">
      </head>
      <body style="font-family: Arial; text-align: center; margin: 50px;">
        <h2>ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ rugcheck Ù„Ù„ØªÙˆÙƒÙ†...</h2>
        <p>Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù</p>
      </body>
      </html>
    `);

    // Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ rugcheck ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    checkTokenSafety(token).then(newStatus => {
      if (trackedTokens[token]) {
        trackedTokens[token].rugcheckStatus = newStatus;
        saveTrackedTokens();
        console.log(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ rugcheck Ù„Ù„ØªÙˆÙƒÙ† ${token}: ${newStatus}`);
        
        // Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© ÙÙˆØ±Ø§Ù‹
        if (newStatus === 'DANGER' || newStatus === 'WARNING') {
          console.log(`[${token}] ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† ${newStatus === 'DANGER' ? 'Ø§Ù„Ø®Ø·ÙŠØ±' : 'Ø§Ù„ØªØ­Ø°ÙŠØ±ÙŠ'} ÙÙˆØ±Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©`);
          stopTrackingToken(token);
        }
      }
    }).catch(error => {
      console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ rugcheck Ù„Ù„ØªÙˆÙƒÙ† ${token}:`, error.message);
    });

    return;
  }

  // endpoint Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚ÙØ©
  if (req.method === "GET" && req.url === "/restart_all_tokens") {
    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <html lang="ar">
      <head>
        <title>Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª</title>
        <meta http-equiv="refresh" content="5; url=/track_token">
        <style>
          body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
          .loading { color: #4CAF50; font-size: 18px; margin: 20px 0; }
        </style>
      </head>
      <body>
        <h2>ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª...</h2>
        <div class="loading">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ 5 Ø«ÙˆØ§Ù†Ù</div>
      </body>
      </html>
    `);
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    restartAllTokens().catch(error => {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª:', error.message);
    });
    
    return;
  }

  // endpoint Ù„Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø¹Ø¨Ø± GET (Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹)
  if (req.method === "GET" && req.url === "/recheck_tokens") {
    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <html lang="ar">
      <head>
        <title>Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª</title>
        <meta http-equiv="refresh" content="5; url=/track_token">
        <style>
          body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
          .loading { color: #0078D7; font-size: 18px; margin: 20px 0; }
        </style>
      </head>
      <body>
        <h2>ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª...</h2>
        <div class="loading">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ 5 Ø«ÙˆØ§Ù†Ù</div>
      </body>
      </html>
    `);
    
    // ØªØ´ØºÙŠÙ„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
    recheckOldTokens().catch(error => {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª:', error.message);
    });
    
    return;
  }

  // endpoint Ù„Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ§ÙÙ‚Ø© (GET request)
  if (req.method === "GET" && req.url === "/delete_dangerous_now") {
    const deletedTokens = deleteDangerousTokens();
    
    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <html lang="ar">
      <head>
        <title>Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©</title>
        <meta http-equiv="refresh" content="2; url=/track_token">
        <style>
          body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
          .result { font-size: 18px; margin: 20px 0; }
          .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 600px; }
          .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 600px; }
          .count { color: #dc3545; font-weight: bold; font-size: 20px; }
          .token-code { background: #f8f9fa; border: 1px solid #dee2e6; padding: 4px 8px; border-radius: 4px; font-family: monospace; margin: 2px; display: inline-block; }
        </style>
      </head>
      <body>
        <h2>ğŸ—‘ï¸ ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø­Ø°Ù Ù…Ø¨Ø§Ø´Ø±Ø©!</h2>
        ${deletedTokens.length > 0 ? `
          <div class="success">
            <div class="result">âœ… ØªÙ… Ø­Ø°Ù <span class="count">${deletedTokens.length}</span> ØªÙˆÙƒÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</div>
            <br/>
            <strong>Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©:</strong><br/>
            ${deletedTokens.map(token => `<span class="token-code">${token}</span>`).join(' ')}
          </div>
        ` : `
          <div class="info">
            <div class="result">â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆÙƒÙ†Ø§Øª Ø®Ø·ÙŠØ±Ø© Ø£Ùˆ ØªØ­Ø°ÙŠØ±ÙŠØ© Ù„Ù„Ø­Ø°Ù</div>
            <div>Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¢Ù…Ù†Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>
          </div>
        `}
        <div style="color: #666; margin-top: 20px;">Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ Ø«Ø§Ù†ÙŠØªÙŠÙ†...</div>
      </body>
      </html>
    `);
    
    return;
  }

  // endpoint Ù„Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ©
  if (req.method === "POST" && req.url === "/delete_dangerous") {
    try {
      const result = await deleteDangerousTokens();
      
      res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <html lang="ar">
        <head>
          <title>Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©</title>
          <meta http-equiv="refresh" content="3; url=/track_token">
          <style>
            body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
            .success { color: #4CAF50; font-size: 18px; margin: 20px 0; }
            .info { color: #666; font-size: 14px; margin: 10px 0; }
            .token-list { background: #fff; border-radius: 8px; padding: 15px; margin: 20px auto; max-width: 500px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
            .token-item { padding: 8px; border-bottom: 1px solid #eee; }
            .token-item:last-child { border-bottom: none; }
          </style>
        </head>
        <body>
          <h2>ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©</h2>
          <div class="success">âœ… ØªÙ… Ø­Ø°Ù ${result.deleted} ØªÙˆÙƒÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</div>
          ${result.tokens.length > 0 ? `
            <div class="token-list">
              <h3>Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©:</h3>
              ${result.tokens.map(t => `
                <div class="token-item">
                  <strong>${t.token}</strong> - 
                  <span style="color: ${t.status === 'DANGER' ? '#F44336' : '#FF9800'};">
                    ${t.status === 'DANGER' ? 'âš ï¸ Ø®Ø·Ø±' : 'ğŸ”¶ ØªØ­Ø°ÙŠØ±'}
                  </span>
                </div>
              `).join('')}
            </div>
          ` : ''}
          <div class="info">Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ 3 Ø«ÙˆØ§Ù†Ù</div>
        </body>
        </html>
      `);
      
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©:', error.message);
      res.writeHead(500, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <html lang="ar">
        <head>
          <title>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù</title>
          <meta http-equiv="refresh" content="3; url=/track_token">
          <style>
            body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
            .error { color: #F44336; font-size: 18px; margin: 20px 0; }
          </style>
        </head>
        <body>
          <h2>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h2>
          <div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª: ${error.message}</div>
          <div>Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ 3 Ø«ÙˆØ§Ù†Ù</div>
        </body>
        </html>
      `);
    }
    return;
  }

  // endpoint Ù„Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© Ø¹Ø¨Ø± GET (Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹)
  if (req.method === "GET" && req.url === "/delete_dangerous") {
    try {
      const result = await deleteDangerousTokens();
      
      res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <html lang="ar">
        <head>
          <title>Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©</title>
          <meta http-equiv="refresh" content="3; url=/track_token">
          <style>
            body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
            .success { color: #4CAF50; font-size: 18px; margin: 20px 0; }
            .info { color: #666; font-size: 14px; margin: 10px 0; }
            .token-list { background: #fff; border-radius: 8px; padding: 15px; margin: 20px auto; max-width: 500px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
            .token-item { padding: 8px; border-bottom: 1px solid #eee; }
            .token-item:last-child { border-bottom: none; }
          </style>
        </head>
        <body>
          <h2>ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©</h2>
          <div class="success">âœ… ØªÙ… Ø­Ø°Ù ${result.deleted} ØªÙˆÙƒÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨</div>
          ${result.tokens.length > 0 ? `
            <div class="token-list">
              <h3>Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©:</h3>
              ${result.tokens.map(t => `
                <div class="token-item">
                  <strong>${t.token}</strong> - 
                  <span style="color: ${t.status === 'DANGER' ? '#F44336' : '#FF9800'};">
                    ${t.status === 'DANGER' ? 'âš ï¸ Ø®Ø·Ø±' : 'ğŸ”¶ ØªØ­Ø°ÙŠØ±'}
                  </span>
                </div>
              `).join('')}
            </div>
          ` : ''}
          <div class="info">Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ 3 Ø«ÙˆØ§Ù†Ù</div>
        </body>
        </html>
      `);
      
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø©:', error.message);
      res.writeHead(500, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <html lang="ar">
        <head>
          <title>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù</title>
          <meta http-equiv="refresh" content="3; url=/track_token">
          <style>
            body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
            .error { color: #F44336; font-size: 18px; margin: 20px 0; }
          </style>
        </head>
        <body>
          <h2>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h2>
          <div class="error">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª: ${error.message}</div>
          <div>Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø®Ù„Ø§Ù„ 3 Ø«ÙˆØ§Ù†Ù</div>
        </body>
        </html>
      `);
    }
    return;
  }

  // ...existing code...
  if (req.method === "GET" && req.url.startsWith("/track_token")) {
    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <html lang="ar">
      <head>
        <title>Token Tracker</title>
        <meta http-equiv="refresh" content="10">
        <style>
          body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; }
          h2 { text-align: center; color: #0078D7; margin-top: 30px; letter-spacing: 1px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
          .tokens-container { max-width: 800px; margin: 30px auto; padding: 0 10px; }
          .token-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 2px solid #e1e8ed;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
            padding: 20px 25px;
            margin-bottom: 25px;
            border-radius: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
          }
          .token-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0078D7, #1890ff, #52c41a);
            opacity: 0.8;
          }
          .token-card:hover { 
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.1);
            border-color: #0078D7;
          }
          .token-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
          }
          .token-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
          }
          .token-label { 
            color: #34495e; 
            font-weight: 600; 
            display: inline-block; 
            min-width: 170px;
            font-size: 0.95em;
          }
          .token-value { color: #0078D7; font-weight: bold; }
          .token-row { 
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px dotted #e8e8e8;
          }
          .token-row:last-child {
            border-bottom: none;
          }
          .delete-btn {
            background: linear-gradient(145deg, #e53935, #d32f2f);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
          }
          .delete-btn:hover { 
            background: linear-gradient(145deg, #d32f2f, #b71c1c);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
          }
        </style>
      </head>
      <body>
        <h2>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª (Token Tracker)</h2>
        <div style='text-align: center; margin-bottom: 20px; color: #666; font-size: 0.9em;'>
          ğŸ”„ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØªØ³ØªÙ…Ø± Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬<br/>
          ğŸ›¡ï¸ ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ ØªÙˆÙƒÙ† Ø¹Ù„Ù‰ rugcheck.xyz: <span style="color: #4CAF50;">âœ… Ø¢Ù…Ù†</span> | <span style="color: #FF9800;">ğŸ”¶ ØªØ­Ø°ÙŠØ±</span> | <span style="color: #F44336;">âš ï¸ Ø®Ø·Ø±</span> | <span style="color: #666;">â“ ØºÙŠØ± Ù…Ø­Ù‚Ù‚</span><br/>
          ğŸ’§ ÙŠØªÙ… ÙØ­Øµ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù…Ù† gmgn.ai: <span style="color: #4CAF50;">âœ… Ø³ÙŠÙˆÙ„Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©</span> | <span style="color: #FF5722;">âš ï¸ Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø©</span> | <span style="color: #666;">â“ ØºÙŠØ± Ù…Ø­Ù‚Ù‚Ø©</span><br/>
          ï¿½ Ù‚ÙŠÙ…Ø© SOL Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙØ±Ø² Ø§Ù„Ø£ØµÙ„ÙŠØ© (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: 10.00 SOL)<br/>
          ï¿½ğŸš« <strong>Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ØªØªÙˆÙ‚Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§ÙƒØªØ´Ø§Ù Ø³ÙŠÙˆÙ„Ø© Ù…Ù†Ø®ÙØ¶Ø©</strong>
        </div>
        <div style='text-align: center; margin-bottom: 15px; color: #FF6B6B; font-size: 0.9em; font-weight: bold;'>
          ğŸ—‘ï¸ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© ÙƒÙ„ Ø³Ø§Ø¹Ø©
        </div>
        <div style='text-align: center; margin-bottom: 20px;'>
          <a href='/restart_all_tokens' style='
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 0 10px;
          ' onmouseover='this.style.transform="translateY(-2px)"' onmouseout='this.style.transform="translateY(0)"'>
            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª
          </a>
          <a href='/recheck_tokens' style='
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 0 10px;
          ' onmouseover='this.style.transform="translateY(-2px)"' onmouseout='this.style.transform="translateY(0)"'>
            ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          </a>
          <a href='/delete_dangerous_now' style='
            background: linear-gradient(45deg, #F44336, #FF9800);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 0 10px;
          ' onmouseover='this.style.transform="translateY(-2px)"' onmouseout='this.style.transform="translateY(0)"'>
            ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø®Ø·ÙŠØ±Ø© Ø§Ù„Ø¢Ù† (ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©)
          </a>
        </div>
        <div class="tokens-container">
        ${Object.values(trackedTokens)
          .sort((a, b) => b.startTime - a.startTime) // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
          .map(t => {
            let percent = '';
            let firstPriceDisplay = '';
            let lastPriceDisplay = '';
            let priceComparison = '';
            
            if (t.firstPrice && t.lastPrice && typeof t.firstPrice === 'number' && typeof t.lastPrice === 'number') {
              const p = ((t.lastPrice - t.firstPrice) / t.firstPrice) * 100;
              percent = (p >= 0 ? '+' : '') + p.toFixed(2) + '%';
              firstPriceDisplay = t.firstPrice + '$';
              lastPriceDisplay = t.lastPrice + '$';
              
              // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨ÙŠÙ† Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„
              const ratio = (t.lastPrice / t.firstPrice).toFixed(2);
              if (ratio >= 10) {
                priceComparison = `ğŸš€ Ø§Ø±ØªÙØ¹ ${ratio}x Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„`;
              } else if (ratio >= 5) {
                priceComparison = `ğŸ“ˆ Ø§Ø±ØªÙØ¹ ${ratio}x Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„`;
              } else if (ratio >= 2) {
                priceComparison = `â¬†ï¸ Ø§Ø±ØªÙØ¹ ${ratio}x Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„`;
              } else if (ratio > 1) {
                priceComparison = `ğŸ”¼ Ø§Ø±ØªÙØ¹ ${ratio}x Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„`;
              } else if (ratio == 1) {
                priceComparison = `â¡ï¸ Ù„Ø§ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ø³Ø¹Ø±`;
              } else {
                priceComparison = `ğŸ”» Ø§Ù†Ø®ÙØ¶ Ø¥Ù„Ù‰ ${ratio}x Ù…Ù† Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„`;
              }
            } else if (t.firstPrice && typeof t.firstPrice === 'string') {
              firstPriceDisplay = t.firstPrice;
              lastPriceDisplay = t.lastPrice || 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
              percent = 'ØºÙŠØ± Ù…ØªØ§Ø­';
              priceComparison = 'ØºÙŠØ± Ù…ØªØ§Ø­';
            } else {
              firstPriceDisplay = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
              lastPriceDisplay = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
              percent = '...';
              priceComparison = '...';
            }
            
            // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© hh:mm:ss
            let duration = '...';
            if (t.startTime) {
              const ms = Date.now() - t.startTime.getTime();
              const totalSeconds = Math.floor(ms / 1000);
              const hours = Math.floor(totalSeconds / 3600);
              const minutes = Math.floor((totalSeconds % 3600) / 60);
              const seconds = totalSeconds % 60;
              duration = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            }
            
            const statusIcon = t.stopped && t.lowLiquidity ? 'ğŸš«' : (t.reached50 ? 'âœ…ï¸' : 'ğŸ”¶');
            
            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„ØªÙˆÙƒÙ† Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
            let tokenDisplayName = t.token;
            if (t.name && t.symbol) {
              tokenDisplayName = `${t.name} (${t.symbol})`;
            } else if (t.name) {
              tokenDisplayName = t.name;
            } else if (t.symbol) {
              tokenDisplayName = `${t.symbol}`;
            }
            
            return `
              <div class="token-card" data-token="${t.token}">
                <div class="token-header">
                  <span class="token-title">${statusIcon} <a href="https://dexscreener.com/solana/${t.token}" target="_blank" style="color: #2196F3; text-decoration: none; font-weight: bold;">${tokenDisplayName}</a></span>
                  <div style="display: flex; gap: 5px;">
                    <button class="recheck-btn" onclick="recheckRugcheck('${t.token}')" style="
                      background: #2196F3;
                      color: white;
                      border: none;
                      padding: 5px 10px;
                      border-radius: 3px;
                      cursor: pointer;
                      font-size: 12px;
                    ">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ</button>
                    <button class="price-details-btn" onclick="viewPriceDetails('${t.token}')" style="
                      background: #4CAF50;
                      color: white;
                      border: none;
                      padding: 5px 10px;
                      border-radius: 3px;
                      cursor: pointer;
                      font-size: 12px;
                    ">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±</button>
                    <button class="delete-btn" onclick="deleteToken('${t.token}')">Ø­Ø°Ù</button>
                  </div>
                </div>
                <div class="token-row"><span class="token-label">ğŸ”— Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆÙƒÙ†:</span> <span style="font-family: monospace; font-size: 0.85em; color: #666; word-break: break-all;">${t.token}</span></div>
                <div class="token-row"><span class="token-label">ğŸ›¡ï¸ Ø­Ø§Ù„Ø© <a href="https://rugcheck.xyz/tokens/${t.token}" target="_blank" style="color: #2196F3; text-decoration: none; font-weight: bold;">rugcheck.xyz</a>:</span> <span style="color: ${t.rugcheckStatus === 'SAFE' ? '#4CAF50' : t.rugcheckStatus === 'DANGER' ? '#F44336' : t.rugcheckStatus === 'WARNING' ? '#FF9800' : '#666'}; font-weight: bold;">${t.rugcheckStatus === 'SAFE' ? 'âœ… Ø¢Ù…Ù†' : t.rugcheckStatus === 'DANGER' ? 'ğŸ”´ Ø®Ø·Ø±' : t.rugcheckStatus === 'WARNING' ? 'âš ï¸ ØªØ­Ø°ÙŠØ±' : 'â“ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚'}</span></div>
                <div class="token-row"><span class="token-label">ğŸ’§ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©:</span> <span style="color: ${t.lowLiquidity === true ? '#FF5722' : t.lowLiquidity === false ? '#4CAF50' : '#666'}; font-weight: bold;">${t.lowLiquidity === true ? 'âš ï¸ Ù…Ù†Ø®ÙØ¶Ø©' : t.lowLiquidity === false ? 'âœ… Ø·Ø¨ÙŠØ¹ÙŠØ©' : 'â“ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚'}</span></div>
                <div class="token-row"><span class="token-label">ï¿½ Ù‚ÙŠÙ…Ø© SOL:</span> <span style="color: #FF9800; font-weight: bold;">${t.solValue ? t.solValue.toFixed(2) + ' SOL' : 'â“ ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}</span></div>
                <div class="token-row"><span class="token-label">ï¿½ğŸ• Ù…Ø¯Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©:</span> ${duration}</div>
                <div class="token-row"><span class="token-label">ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ„:</span> ${firstPriceDisplay}</div>
                <div class="token-row"><span class="token-label">ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:</span> ${lastPriceDisplay}</div>
                <div class="token-row"><span class="token-label">ğŸ“Š Ø§Ù„ØªØºÙŠÙŠØ±:</span> ${percent}</div>
                <div class="token-row"><span class="token-label">ï¿½ Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ø±ØªÙØ§Ø¹:</span> <span style="color: #4CAF50; font-weight: bold;">${t.maxRisePercentage ? t.maxRisePercentage.toFixed(2) + '%' : '0%'}</span></div>
                <div class="token-row"><span class="token-label">ï¿½ğŸ“ˆ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©:</span> ${priceComparison}</div>
                <div class="token-row"><span class="token-label">ğŸ¯ Ø­Ù‚Ù‚ 50%:</span> ${t.reached50 ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}</div>
                <div class="token-row"><span class="token-label">â° Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©:</span> ${t.startTime ? t.startTime.toLocaleString('ar-EG') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                ${t.stopped ? '<div class="token-row"><span class="token-label">ğŸ›‘ Ø§Ù„Ø³Ø¨Ø¨:</span> ' + (t.lowLiquidity ? 'ØªÙˆÙ‚ÙØª Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©' : t.rugcheckStatus === 'DANGER' || t.rugcheckStatus === 'WARNING' ? 'ØªÙˆÙ‚ÙØª Ø¨Ø³Ø¨Ø¨ Ø­Ø§Ù„Ø© rugcheck' : 'ØªÙˆÙ‚ÙØª Ù„Ø³Ø¨Ø¨ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ') + '</div>' : ''}
              </div>
            `;
          }).join('')}
        </div>
        
        <script>
          function deleteToken(token) {
            // Ø­Ø°Ù Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨ Ù…ÙˆØ§ÙÙ‚Ø©
            fetch('/delete-token', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ token })
            })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                location.reload();
              } else {
                alert('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù: ' + data.error);
              }
            })
            .catch(err => {
              console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù:', err);
              alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + err.message);
            });
          }
          
          function recheckRugcheck(token) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ rugcheck Ù„Ù‡Ø°Ø§ Ø§Ù„ØªÙˆÙƒÙ†ØŸ')) {
              window.open('/recheck_rugcheck/' + token, '_blank');
              // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù
              setTimeout(() => location.reload(), 3000);
            }
          }
          
          function viewPriceDetails(token) {
            window.open('/price_details/' + token, '_blank');
          }
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© ÙƒÙ„ 10 Ø«ÙˆØ§Ù†Ù
          setTimeout(() => location.reload(), 10000);
        </script>
      </body>
    </html>
    `);
    return;
  }

  // ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ØªÙˆÙƒÙ†
  if (req.method === "GET" && req.url.startsWith("/price_details/")) {
    const token = req.url.split("/price_details/")[1];
    
    if (!trackedTokens[token]) {
      res.writeHead(404, { "Content-Type": "text/html; charset=utf-8" });
      res.end(`
        <html lang="ar">
        <head>
          <title>Ø®Ø·Ø£ - Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</title>
          <style>
            body { font-family: Tahoma, Arial, sans-serif; background: #f5f6fa; margin: 0; padding: 20px; direction: rtl; text-align: center; }
            .error { background: #FF6B6B; color: white; padding: 20px; border-radius: 10px; margin: 20px auto; max-width: 500px; }
          </style>
        </head>
        <body>
          <div class="error">
            <h2>âŒ Ø®Ø·Ø£</h2>
            <p>Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</p>
            <button onclick="window.close()" style="background: white; color: #FF6B6B; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;">Ø¥ØºÙ„Ø§Ù‚</button>
          </div>
        </body>
        </html>
      `);
      return;
    }

    const t = trackedTokens[token];
    
    // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„ØªÙˆÙƒÙ† Ø£Ùˆ Ø§Ù„Ø±Ù…Ø² Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
    let tokenDisplayName = token;
    if (t.name && t.symbol) {
      tokenDisplayName = `${t.name} (${t.symbol})`;
    } else if (t.name) {
      tokenDisplayName = t.name;
    } else if (t.symbol) {
      tokenDisplayName = `${t.symbol}`;
    }

    // Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆØµÙ„ Ø¥Ù„ÙŠÙ‡ Ø§Ù„ØªÙˆÙƒÙ†
    const highestPriceDisplay = t.highestPrice ? `$${formatPrice(t.highestPrice)}` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
    
    // Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ø±ØªÙØ§Ø¹
    const maxRiseDisplay = t.maxRisePercentage ? `${t.maxRisePercentage.toFixed(2)}%` : '0%';
    
    // ØªØ­Ø¶ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙƒÙ„ 20 Ø«Ø§Ù†ÙŠØ© (Ø¢Ø®Ø± 20 Ø³Ø¬Ù„)
    const recentPriceHistory = t.priceHistoryEvery20s ? t.priceHistoryEvery20s.slice(-20) : [];
    
    let priceHistoryHTML = '';
    if (recentPriceHistory.length > 0) {
      priceHistoryHTML = recentPriceHistory.map(record => {
        const changeSign = record.changePercent >= 0 ? '+' : '';
        const changeColor = record.changePercent >= 0 ? '#4CAF50' : '#F44336';
        const timestamp = new Date(record.timestamp).toLocaleTimeString('ar-EG');
        
        return `
          <div style="
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
          ">
            <div style="font-size: 18px; font-weight: bold; color: #333;">
              $${formatPrice(record.price)}
            </div>
            <div style="font-size: 16px; font-weight: bold; color: ${changeColor};">
              ${changeSign}${record.changePercent.toFixed(2)}%
            </div>
            <div style="font-size: 14px; color: #666;">
              ${timestamp}
            </div>
          </div>
        `;
      }).join('');
    } else {
      priceHistoryHTML = `
        <div style="
          background: white;
          border: 1px solid #ddd;
          border-radius: 8px;
          padding: 20px;
          margin: 10px 0;
          text-align: center;
          color: #666;
        ">
          Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ®ÙŠØ© Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯
        </div>
      `;
    }

    res.writeHead(200, { "Content-Type": "text/html; charset=utf-8" });
    res.end(`
      <html lang="ar">
      <head>
        <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± - ${tokenDisplayName}</title>
        <meta http-equiv="refresh" content="20">
        <style>
          body { 
            font-family: Tahoma, Arial, sans-serif; 
            background: #f5f6fa; 
            margin: 0; 
            padding: 20px; 
            direction: rtl; 
          }
          .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          }
          .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #0078D7;
            padding-bottom: 20px;
          }
          .title {
            color: #0078D7;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
          }
          .token-address {
            font-family: monospace;
            font-size: 14px;
            color: #666;
            word-break: break-all;
          }
          .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
          }
          .info-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e9ecef;
          }
          .info-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
          }
          .info-value {
            font-size: 20px;
            font-weight: bold;
            color: #333;
          }
          .highest-price { color: #4CAF50; }
          .max-rise { color: #FF9800; }
          .history-section {
            margin-top: 30px;
          }
          .history-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
          }
          .close-btn {
            background: #F44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: block;
            margin: 20px auto 0;
          }
          .close-btn:hover {
            background: #D32F2F;
          }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <div class="title">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±</div>
            <div style="font-size: 18px; color: #333; margin: 10px 0;">
              <a href="https://dexscreener.com/solana/${token}" target="_blank" style="color: #0078D7; text-decoration: none;">
                ${tokenDisplayName}
              </a>
            </div>
            <div class="token-address">${token}</div>
          </div>
          
          <div class="info-grid">
            <div class="info-card">
              <div class="info-label">ğŸš€ Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± ÙˆØµÙ„ Ø¥Ù„ÙŠÙ‡ Ø§Ù„ØªÙˆÙƒÙ†</div>
              <div class="info-value highest-price">${highestPriceDisplay}</div>
            </div>
            <div class="info-card">
              <div class="info-label">ğŸ“ˆ Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ø±ØªÙØ§Ø¹</div>
              <div class="info-value max-rise">${maxRiseDisplay}</div>
            </div>
          </div>
          
          <div class="history-section">
            <div class="history-title">ğŸ“Š ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (ÙƒÙ„ 20 Ø«Ø§Ù†ÙŠØ© - Ø¢Ø®Ø± 20 Ø³Ø¬Ù„)</div>
            ${priceHistoryHTML}
          </div>
          
          <button class="close-btn" onclick="window.close()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©</button>
        </div>
      </body>
      </html>
    `);
    return;
  }

  // Ù…Ø¹Ø§Ù„Ø¬ Ù„Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
  res.writeHead(404, { "Content-Type": "text/html; charset=utf-8" });
  res.end(`
    <html lang="ar">
    <head>
      <title>404 - Ø§Ù„ØµÙØ­Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</title>
      <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #f5f6fa; }
        .error { background: white; border-radius: 10px; padding: 30px; max-width: 500px; margin: 0 auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
      </style>
    </head>
    <body>
      <div class="error">
        <h1>ğŸš« 404 - Ø§Ù„ØµÙØ­Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</h1>
        <p>Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØºÙŠØ± Ù…ØªØ§Ø­</p>
        <a href="/" style="color: #0078D7; text-decoration: none; font-weight: bold;">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>
    </body>
    </html>
  `);
});

server.listen(PORT, '0.0.0.0', async () => {
  console.log(`ğŸŒ Server running on port ${PORT}`);
  console.log(`ğŸ”— Token tracking link: http://localhost:${PORT}/track_token`);
  console.log(`ğŸ”— Health check: http://localhost:${PORT}/health`);
  console.log(`ğŸ”— Status check: http://localhost:${PORT}/status`);
  
  // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø°Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙˆÙƒÙ†Ø§Øª Ø§Ù„Ø®Ø·ÙŠØ±Ø© ÙˆØ§Ù„ØªØ­Ø°ÙŠØ±ÙŠØ© ÙƒÙ„ Ø³Ø§Ø¹Ø©
  startAutoDeletion();
  console.log('âœ… Automatic deletion enabled every hour for dangerous and warning tokens')
  
  // Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
  setTimeout(async () => {
    try {
      await recheckOldTokens();
    } catch (error) {
      console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„ØªÙƒÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:', error.message);
    }
  }, 5000); // Ø§Ù†ØªØ¸Ø§Ø± 5 Ø«ÙˆØ§Ù†Ù Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø³ÙŠØ±ÙØ±
}).on('error', (err) => {
  console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…:', err);
  process.exit(1);
});

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
process.on('uncaughtException', (err) => {
  console.error('âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹:', err);
  process.exit(1);
});

process.on('unhandledRejection', (reason, promise) => {
  console.error('âŒ Ø±ÙØ¶ ØºÙŠØ± Ù…Ø¹Ø§Ù„Ø¬:', reason);
  process.exit(1);
});

// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
async function sendToGroups(message) {
  try {
    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§)
    const targetGroups = [
      // Ø£Ø¶Ù Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù‡Ù†Ø§
      // Ù…Ø«Ø§Ù„: -1001234567890
    ];

    for (const groupId of targetGroups) {
      try {
        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ø¨Ø± Telegram
        console.log(`Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${groupId}: ${message}`);
        
        // Ù…Ø«Ø§Ù„ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© (ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªÙØ¹ÙŠÙ„ TelegramClient)
        /*
        await client.sendMessage(groupId, {
          message: message,
          parseMode: 'markdown'
        });
        */
      } catch (error) {
        console.error(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ${groupId}: ${error.message}`);
      }
    }
  } catch (error) {
    console.error(`Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${error.message}`);
  }
}
